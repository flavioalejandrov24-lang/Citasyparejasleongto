<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LionMatch - Conecta en León, GTO</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">
<style>
/* ================================================
   LIONMATCH - ESTILOS
   Paleta: Índigo profundo + Rosa coral
   ================================================ */
* { margin:0; padding:0; box-sizing:border-box; }

:root {
    --primary:        #7c3aed;
    --primary-dark:   #5b21b6;
    --primary-light:  #a78bfa;
    --secondary:      #ec4899;
    --accent:         #f59e0b;
    --bg-dark:        #0f0a1e;
    --bg-mid:         #1a1033;
    --bg-card:        #160d2e;   /* fondo oscuro para TODAS las pantallas */
    --bg-surface:     #1e1240;   /* superficies de tarjetas internas */
    --bg-input:       rgba(255,255,255,.07);
    --bg-input-light: rgba(255,255,255,.12);
    --text-dark:      #e9d5ff;   /* texto principal sobre fondo oscuro */
    --text-light:     #9d8ec4;
    --text-white:     #ffffff;
    --border-color:   rgba(167,139,250,.25);
    --success:        #10b981;
    --danger:         #ef4444;
    --shadow-glow:    0 0 45px rgba(124,58,237,.4);
    --radius-sm:      .5rem;
    --radius-md:      1rem;
    --radius-lg:      1.5rem;
    --radius-xl:      2rem;
    --transition:     all .3s ease;
}

body {
    font-family: 'Poppins', sans-serif;
    background: var(--bg-dark);
    color: var(--text-dark);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    overflow-x: hidden;
}

.app-container {
    max-width: 480px;
    margin: 0 auto;
    background: var(--bg-card);
    min-height: 100vh;
    position: relative;
    box-shadow: 0 0 80px rgba(124,58,237,.2);
}

/* ── Pantallas ─────────────────────────────────── */
.screen {
    position: absolute; top:0; left:0;
    width:100%; min-height:100vh;
    background: var(--bg-card);
    opacity:0; pointer-events:none;
    transform: translateX(100%);
    transition: transform .4s cubic-bezier(.4,0,.2,1), opacity .4s ease;
}
.screen.active { opacity:1; pointer-events:all; transform:translateX(0); }

/* ================================================
   LOGIN
   ================================================ */
#login-screen {
    background: linear-gradient(160deg, var(--bg-dark) 0%, var(--bg-mid) 55%, #2d1b4e 100%);
    display:flex; align-items:center; justify-content:center;
    padding:2rem; position:relative; overflow:hidden;
}
#login-screen::before {
    content:'';
    position:absolute; top:-50%; left:-50%; width:200%; height:200%;
    background:
        radial-gradient(circle at 30% 25%, rgba(124,58,237,.22) 0%, transparent 50%),
        radial-gradient(circle at 72% 72%, rgba(236,72,153,.18) 0%, transparent 50%);
    animation: bgPulse 9s ease-in-out infinite;
}
@keyframes bgPulse {
    0%,100% { transform:scale(1); opacity:.6; }
    50%      { transform:scale(1.08); opacity:1; }
}

.login-container { width:100%; max-width:400px; position:relative; z-index:1; }

.logo-section { text-align:center; margin-bottom:2.5rem; animation: fadeInDown .6s ease; }
@keyframes fadeInDown {
    from { opacity:0; transform:translateY(-30px); }
    to   { opacity:1; transform:translateY(0); }
}

.app-logo {
    width:84px; height:84px; margin:0 auto 1.2rem;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    border-radius: var(--radius-xl);
    display:flex; align-items:center; justify-content:center;
    box-shadow: var(--shadow-glow);
    animation: float 3s ease-in-out infinite;
}
@keyframes float {
    0%,100% { transform:translateY(0) rotate(3deg); }
    50%      { transform:translateY(-10px) rotate(-3deg); }
}
.app-logo svg { width:40px; height:40px; color:white; fill:white; }

.app-title {
    font-size:3rem; font-weight:900; font-style:italic;
    background: linear-gradient(135deg, #ffffff 0%, var(--primary-light) 100%);
    -webkit-background-clip:text; -webkit-text-fill-color:transparent;
    background-clip:text; margin-bottom:.4rem; letter-spacing:-.05em;
}
.app-subtitle { color:rgba(255,255,255,.7); font-size:1rem; font-weight:500; }

/* ================================================
   FORMULARIOS (globales)
   ================================================ */
.auth-form { animation: fadeInUp .6s ease .2s both; }
@keyframes fadeInUp {
    from { opacity:0; transform:translateY(30px); }
    to   { opacity:1; transform:translateY(0); }
}

.form-group { margin-bottom:1.4rem; }

.form-group label {
    display:block; margin-bottom:.45rem;
    color:rgba(255,255,255,.85); font-weight:600; font-size:.875rem;
}

.form-group input,
.form-group select,
.form-group textarea {
    width:100%; padding:1rem 1.25rem;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-md);
    background: var(--bg-input);
    color: var(--text-white);
    font-size:1rem; font-family:inherit;
    transition: var(--transition);
    backdrop-filter: blur(8px);
}
.form-group select option { background: var(--bg-mid); color: white; }

.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline:none;
    border-color: var(--primary);
    background: var(--bg-input-light);
    box-shadow: 0 0 0 4px rgba(124,58,237,.18);
}
.form-group input::placeholder,
.form-group textarea::placeholder { color:rgba(255,255,255,.35); }

/* ── Toggle password (ojito) ───────────────────── */
.password-input-wrapper { position:relative; }
.password-input-wrapper input { padding-right:3.5rem; }

.toggle-password {
    position:absolute; right:.85rem; top:50%;
    transform:translateY(-50%);
    background:none; border:none; cursor:pointer;
    padding:.4rem; line-height:0;
    color:rgba(255,255,255,.45);
    transition: color .2s, transform .2s;
    display:flex; align-items:center; justify-content:center;
    /* MUY IMPORTANTE: asegura que el botón sea siempre clickeable */
    z-index: 10;
    pointer-events: all !important;
}
.toggle-password:hover { color: var(--primary-light); transform:translateY(-50%) scale(1.15); }
.toggle-password svg { width:21px; height:21px; display:block; pointer-events:none; }

/* ── Checkbox ──────────────────────────────────── */
.checkbox-group { display:flex; align-items:center; }
.checkbox-label {
    display:flex; align-items:center; gap:.75rem;
    cursor:pointer; color:rgba(255,255,255,.8);
    font-size:.9rem; user-select:none;
}
.checkbox-label input[type="checkbox"] {
    width:20px; height:20px; cursor:pointer;
    accent-color: var(--primary);
}

/* ================================================
   BOTONES
   ================================================ */
.btn {
    width:100%; padding:1.2rem 2rem; border:none;
    border-radius: var(--radius-md);
    font-size:1rem; font-weight:700;
    text-transform:uppercase; letter-spacing:.06em;
    cursor:pointer; transition: var(--transition);
    font-family:inherit;
    display:inline-flex; align-items:center; justify-content:center; gap:.5rem;
    position: relative; /* para el spinner loading */
}

.btn-primary {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color:white;
    box-shadow: 0 8px 24px rgba(124,58,237,.4);
}
.btn-primary:hover { transform:translateY(-2px); box-shadow: 0 14px 32px rgba(124,58,237,.5); }
.btn-primary:active { transform:translateY(0); }

.btn-secondary {
    background: rgba(255,255,255,.08);
    color: rgba(255,255,255,.9);
    border: 2px solid rgba(255,255,255,.18);
    backdrop-filter: blur(10px);
}
.btn-secondary:hover { background:rgba(255,255,255,.14); border-color:rgba(255,255,255,.3); }

.btn-success {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color:white; box-shadow: 0 8px 24px rgba(124,58,237,.35);
}
.btn-success:hover { transform:translateY(-2px); opacity:.92; }

.btn-danger { background: var(--danger); color:white; }
.btn-danger:hover { background:#dc2626; transform:translateY(-2px); }

/* ── Botones traslúcidos registro ──────────────── */
.btn-register-accept {
    background: rgba(124,58,237,.16);
    color: var(--primary-light);
    border: 2px solid rgba(124,58,237,.55);
    font-weight:700; letter-spacing:.04em;
    transition: all .25s ease;
    position: relative;
}
.btn-register-accept:hover {
    background: rgba(124,58,237,.3);
    border-color: rgba(124,58,237,.85);
    box-shadow: 0 6px 24px rgba(124,58,237,.35);
    transform:translateY(-2px); color:white;
}
.btn-register-accept:active { transform:translateY(0); }
.btn-register-accept.loading { color:transparent; pointer-events:none; }
.btn-register-accept.loading::after {
    content:''; position:absolute; top:50%; left:50%;
    transform:translate(-50%,-50%);
    width:20px; height:20px;
    border:3px solid rgba(167,139,250,.3); border-radius:50%;
    border-top-color: var(--primary-light); animation:spin 1s linear infinite;
}

.btn-register-cancel {
    background: rgba(239,68,68,.12);
    color: #fca5a5;
    border: 2px solid rgba(239,68,68,.45);
    font-weight:700; letter-spacing:.04em; transition: all .25s ease;
}
.btn-register-cancel:hover {
    background:rgba(239,68,68,.24); border-color:rgba(239,68,68,.75);
    transform:translateY(-2px); color:white;
}
.btn-register-cancel:active { transform:translateY(0); }

.form-actions {
    display:grid; grid-template-columns:1fr 1fr;
    gap:1rem; margin-top:1.8rem;
}

/* ── Olvidé contraseña ─────────────────────────── */
.forgot-password {
    display:block; text-align:center;
    color: var(--primary-light); text-decoration:none;
    margin: 1rem 0; font-size:.9rem; font-weight:500;
    transition: var(--transition);
}
.forgot-password:hover { color: var(--secondary); }

.divider { margin:1.8rem 0; text-align:center; position:relative; }
.divider::before {
    content:''; position:absolute; top:50%; left:0; right:0;
    height:1px; background:rgba(255,255,255,.1);
}
.divider span {
    position:relative; background: var(--bg-dark);
    padding:0 1rem; color:rgba(255,255,255,.45);
    font-size:.9rem; font-weight:500;
}

/* ================================================
   REGISTRO / ONBOARDING / EDITAR PERFIL
   Todos con fondo oscuro igual al login
   ================================================ */
#register-screen,
#onboarding-screen,
#edit-profile-screen {
    background: linear-gradient(160deg, var(--bg-dark) 0%, var(--bg-mid) 60%, #1f1240 100%);
}

.register-container,
.onboarding-container,
.edit-profile-container {
    padding:2rem; max-width:480px; margin:0 auto;
}

.screen-title {
    font-size:1.9rem; font-weight:800;
    color:white; margin-bottom:.4rem;
}
.screen-subtitle { color: var(--text-light); margin-bottom:1.8rem; }

.back-button {
    background:rgba(255,255,255,.08); border:none;
    width:44px; height:44px; border-radius:50%;
    display:flex; align-items:center; justify-content:center;
    cursor:pointer; margin-bottom:1.5rem;
    transition: var(--transition);
    border: 1px solid var(--border-color);
}
.back-button:hover { background:rgba(124,58,237,.25); transform:scale(1.05); }
.back-button svg { width:20px; height:20px; color:white; }

/* ── Progress bar ──────────────────────────────── */
.progress-bar {
    height:4px; background:rgba(255,255,255,.12);
    border-radius:2px; margin-bottom:2rem; overflow:hidden;
}
.progress-fill {
    height:100%; width:33.33%; transition:width .3s ease;
    background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
}

.form-step { display:none; }
.form-step.active { display:block; animation:fadeIn .3s ease; }
@keyframes fadeIn { from { opacity:0; } to { opacity:1; } }

.button-group { display:grid; grid-template-columns:repeat(auto-fit,minmax(110px,1fr)); gap:.75rem; }
.choice-btn {
    padding:.9rem; border: 2px solid var(--border-color);
    background: var(--bg-input); border-radius: var(--radius-md);
    font-weight:600; color: var(--text-light); cursor:pointer;
    transition: var(--transition); font-family:inherit;
}
.choice-btn:hover { border-color: var(--primary); color: var(--primary-light); }
.choice-btn.active {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color:white; border-color: var(--primary);
}

.location-input-locked {
    display:flex; align-items:center; gap:.75rem;
    padding:1rem 1.25rem;
    background: rgba(124,58,237,.1);
    border: 2px solid rgba(124,58,237,.3);
    border-radius: var(--radius-md);
}
.location-input-locked svg { width:20px; height:20px; color: var(--primary-light); }
.location-input-locked input {
    flex:1; background:none; border:none; padding:0;
    color: var(--primary-light); font-weight:600; font-family:inherit;
}

.help-text { margin-top:.5rem; font-size:.82rem; color: var(--text-light); }
.char-count { display:block; text-align:right; font-size:.82rem; color: var(--text-light); margin-top:.25rem; }

.form-navigation { display:flex; gap:1rem; margin-top:1.8rem; }
.form-navigation .btn { flex:1; }

/* ================================================
   HEADER
   ================================================ */
.app-header {
    display:flex; align-items:center; justify-content:space-between;
    padding:1rem 1.5rem;
    background: rgba(22,13,46,.95);
    border-bottom: 1px solid var(--border-color);
    position:sticky; top:0; z-index:50;
    backdrop-filter: blur(12px);
}
.menu-btn {
    background:none; border:none; width:40px; height:40px;
    display:flex; align-items:center; justify-content:center;
    cursor:pointer; border-radius: var(--radius-sm); transition: var(--transition);
}
.menu-btn:hover { background:rgba(124,58,237,.2); }
.menu-btn svg { width:24px; height:24px; color:white; }

.header-logo {
    font-size:1.5rem; font-weight:900; font-style:italic;
    background: linear-gradient(135deg, var(--primary-light) 0%, var(--secondary) 100%);
    -webkit-background-clip:text; -webkit-text-fill-color:transparent; background-clip:text;
}
.header-title { font-size:1.2rem; font-weight:700; color:white; }
.header-location { width:40px; height:40px; display:flex; align-items:center; justify-content:center; }
.header-location svg { width:24px; height:24px; color: var(--primary-light); }

/* ================================================
   DESCUBRIMIENTO
   ================================================ */
.discovery-container { padding:2rem 1.5rem 6rem; }

.cards-stack { position:relative; width:100%; height:500px; margin-bottom:2rem; }

.profile-card-swipe {
    position:absolute; width:100%; height:100%;
    border-radius: var(--radius-xl); overflow:hidden;
    box-shadow: 0 12px 40px rgba(0,0,0,.35);
    cursor:grab; transition:transform .3s ease, box-shadow .3s ease;
}
.profile-card-swipe:active { cursor:grabbing; }
.profile-card-swipe img { width:100%; height:100%; object-fit:cover; }

.profile-card-info {
    position:absolute; bottom:0; left:0; right:0;
    padding:2rem;
    background: linear-gradient(to top, rgba(10,5,20,.88) 0%, transparent 100%);
    color:white;
}
.profile-card-info h3 { font-size:1.75rem; font-weight:800; margin-bottom:.4rem; }
.profile-card-info p  { font-size:.9rem; opacity:.85; line-height:1.5; }

.swipe-indicator {
    position:absolute; top:2rem; padding:1rem 2rem;
    border-radius: var(--radius-lg); font-weight:800;
    font-size:1.5rem; text-transform:uppercase;
    opacity:0; transition:opacity .3s ease; pointer-events:none;
}
.swipe-indicator.like { right:2rem; background: var(--primary); color:white; border:3px solid white; transform:rotate(15deg); }
.swipe-indicator.nope { left:2rem;  background: var(--danger);  color:white; border:3px solid white; transform:rotate(-15deg); }
.swipe-indicator.show { opacity:1; }

.no-more-cards {
    display:flex; flex-direction:column; align-items:center;
    justify-content:center; height:100%; text-align:center; padding:2rem;
}
.no-more-cards svg { width:80px; height:80px; color: var(--primary-light); margin-bottom:1.5rem; stroke-width:1.5; }
.no-more-cards h3 { font-size:1.5rem; font-weight:700; color:white; margin-bottom:.5rem; }
.no-more-cards p { color: var(--text-light); }

.action-buttons { display:flex; justify-content:center; gap:2rem; }
.action-btn {
    width:70px; height:70px; border-radius:50%; border:none;
    background: var(--bg-surface);
    box-shadow: 0 5px 20px rgba(0,0,0,.3);
    cursor:pointer; transition: var(--transition);
    display:flex; align-items:center; justify-content:center;
}
.action-btn:hover  { transform:scale(1.1); }
.action-btn:active { transform:scale(.95); }
.dislike-btn svg { width:30px; height:30px; color: var(--danger); stroke-width:2.5; }
.like-btn {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    box-shadow: 0 5px 20px rgba(124,58,237,.4);
}
.like-btn svg { width:32px; height:32px; color:white; stroke-width:2.5; }

/* ================================================
   MENSAJES
   ================================================ */
.messages-container { padding:1rem; }
.matches-carousel {
    display:flex; gap:1rem; overflow-x:auto;
    padding:1rem 0; margin-bottom:1.5rem; scrollbar-width:none;
}
.matches-carousel::-webkit-scrollbar { display:none; }

.match-item { flex-shrink:0; text-align:center; cursor:pointer; }
.match-avatar {
    width:70px; height:70px; border-radius:50%; object-fit:cover;
    border:3px solid var(--primary); margin-bottom:.5rem; transition: var(--transition);
}
.match-item:hover .match-avatar { transform:scale(1.06); }
.match-name { font-size:.82rem; font-weight:600; color: var(--text-dark); }

.conversations-list { min-height:400px; }
.conversation-item {
    display:flex; align-items:center; gap:1rem;
    padding:1rem; border-radius: var(--radius-md);
    cursor:pointer; transition: var(--transition); margin-bottom:.5rem;
}
.conversation-item:hover { background: var(--bg-surface); }
.conversation-avatar-wrapper { position:relative; }
.conversation-avatar { width:60px; height:60px; border-radius:50%; object-fit:cover; }
.online-indicator {
    position:absolute; bottom:2px; right:2px;
    width:14px; height:14px; background: var(--success);
    border:2px solid var(--bg-card); border-radius:50%;
}
.conversation-info { flex:1; min-width:0; }
.conversation-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:.25rem; }
.conversation-name    { font-weight:700; color:white; }
.conversation-time    { font-size:.78rem; color: var(--text-light); }
.conversation-message { color: var(--text-light); font-size:.88rem; overflow:hidden; text-overflow:ellipsis; white-space:nowrap; }

.empty-state { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:4rem 2rem; text-align:center; }
.empty-state svg { width:60px; height:60px; color: var(--text-light); margin-bottom:1rem; stroke-width:1.5; }
.empty-state h3 { font-size:1.25rem; font-weight:700; color:white; margin-bottom:.5rem; }
.empty-state p  { color: var(--text-light); }

/* ================================================
   CHAT
   ================================================ */
.chat-header {
    display:flex; align-items:center; gap:1rem;
    padding:1rem 1.5rem;
    background: var(--bg-mid);
    border-bottom: 1px solid var(--border-color);
}
.chat-user-info { display:flex; align-items:center; gap:1rem; flex:1; }
.chat-avatar { width:45px; height:45px; border-radius:50%; object-fit:cover; border:2px solid var(--primary); }
.chat-user-info h3 { font-size:1rem; font-weight:700; color:white; }
.online-status { font-size:.78rem; color: var(--success); }

.chat-messages {
    flex:1; overflow-y:auto; padding:1.5rem;
    background: var(--bg-dark); min-height:calc(100vh - 140px);
}
.message { display:flex; margin-bottom:1rem; animation:messageIn .3s ease; }
@keyframes messageIn {
    from { opacity:0; transform:translateY(10px); }
    to   { opacity:1; transform:translateY(0); }
}
.message.sent { justify-content:flex-end; }
.message-bubble { max-width:72%; padding:.75rem 1rem; border-radius: var(--radius-md); font-size:.92rem; }
.message.received .message-bubble { background: var(--bg-surface); color:white; border-bottom-left-radius:4px; }
.message.sent     .message-bubble {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color:white; border-bottom-right-radius:4px;
}

.chat-input-container {
    display:flex; gap:.75rem; padding:1rem 1.5rem;
    background: var(--bg-mid);
    border-top: 1px solid var(--border-color);
}
.chat-input-container input {
    flex:1; padding:.75rem 1rem;
    border: 2px solid var(--border-color);
    border-radius: var(--radius-lg);
    background: var(--bg-input);
    color:white; font-size:.92rem; font-family:inherit;
    transition: var(--transition);
}
.chat-input-container input:focus { outline:none; border-color: var(--primary); }
.chat-input-container input::placeholder { color:rgba(255,255,255,.3); }

.send-btn {
    width:45px; height:45px; border-radius:50%; border:none;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color:white; display:flex; align-items:center; justify-content:center;
    cursor:pointer; transition: var(--transition);
}
.send-btn:hover { transform:scale(1.07); opacity:.9; }
.send-btn svg { width:20px; height:20px; }

/* ================================================
   PERFIL
   ================================================ */
.profile-container { padding:1.5rem; }
.profile-card {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    border-radius: var(--radius-xl); padding:2.5rem 2rem; text-align:center;
    color:white; margin-bottom:1.5rem;
    box-shadow: 0 12px 35px rgba(124,58,237,.35);
}
.profile-photo {
    width:120px; height:120px; border-radius:50%;
    background:rgba(255,255,255,.2); margin:0 auto 1.5rem;
    display:flex; align-items:center; justify-content:center;
    border:4px solid rgba(255,255,255,.6);
}
.profile-photo svg { width:60px; height:60px; color:white; }
.profile-card h2 { font-size:1.75rem; font-weight:800; margin-bottom:.25rem; }
.profile-age { font-size:1rem; opacity:.9; }

.profile-info {
    background: var(--bg-surface); border-radius: var(--radius-lg);
    padding:1.5rem; margin-bottom:1.5rem;
    border: 1px solid var(--border-color);
}
.info-section { margin-bottom:1.5rem; }
.info-section:last-child { margin-bottom:0; }
.info-section h3 {
    font-size:.82rem; font-weight:700; color: var(--primary-light);
    text-transform:uppercase; letter-spacing:.06em; margin-bottom:.5rem;
}
.info-section p { color: var(--text-dark); line-height:1.6; }
.profile-actions { display:flex; flex-direction:column; gap:1rem; }

/* ================================================
   SIDEBAR
   ================================================ */
.sidebar {
    position:fixed; top:0; left:0; width:300px; height:100%;
    background: var(--bg-mid);
    border-right: 1px solid var(--border-color);
    box-shadow: 4px 0 30px rgba(0,0,0,.4);
    z-index:100; transform:translateX(-100%); transition:transform .3s ease;
    display:flex; flex-direction:column;
}
.sidebar.open { transform:translateX(0); }

.sidebar-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color:white; padding:2rem 1.5rem; position:relative;
}
.sidebar-header h2 { font-size:1.75rem; font-weight:900; font-style:italic; margin-bottom:.25rem; }
.sidebar-header p  { font-size:.82rem; opacity:.85; }

.close-sidebar {
    position:absolute; top:1rem; right:1rem;
    background:rgba(255,255,255,.2); border:none;
    width:36px; height:36px; border-radius:50%;
    display:flex; align-items:center; justify-content:center;
    cursor:pointer; transition: var(--transition);
}
.close-sidebar:hover { background:rgba(255,255,255,.35); }
.close-sidebar svg { width:18px; height:18px; color:white; }

.sidebar-nav { flex:1; padding:1.5rem; }
.nav-item {
    display:flex; align-items:center; gap:1rem;
    padding:.9rem 1rem; border-radius: var(--radius-md);
    color: var(--text-light); text-decoration:none;
    font-weight:600; transition: var(--transition); margin-bottom:.4rem;
}
.nav-item:hover { background:rgba(124,58,237,.2); color: var(--primary-light); }
.nav-item.active {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color:white;
}
.nav-item svg { width:22px; height:22px; }

.sidebar-footer { padding:1.5rem; border-top: 1px solid var(--border-color); }
.logout-btn {
    width:100%; padding:1rem; background:none; border:none;
    color: #fca5a5; font-weight:600; font-size:.9rem;
    cursor:pointer; display:flex; align-items:center; justify-content:center;
    gap:.5rem; border-radius: var(--radius-md); transition: var(--transition);
    font-family:inherit;
}
.logout-btn:hover { background:rgba(239,68,68,.12); color: var(--danger); }
.logout-btn svg { width:20px; height:20px; }

.sidebar-overlay {
    position:fixed; top:0; left:0; width:100%; height:100%;
    background:rgba(5,2,15,.65); z-index:99;
    opacity:0; pointer-events:none; transition:opacity .3s ease;
}
.sidebar-overlay.active { opacity:1; pointer-events:all; }

/* ================================================
   MODALES WIN10
   ================================================ */
.win10-modal-overlay {
    position:fixed; top:0; left:0; right:0; bottom:0;
    background:rgba(5,2,15,.7); backdrop-filter:blur(6px);
    display:flex; align-items:center; justify-content:center;
    z-index:1000; opacity:0; pointer-events:none;
    transition:opacity .25s ease; padding:1rem;
}
.win10-modal-overlay.active { opacity:1; pointer-events:all; }

.win10-modal {
    background:#f2f2f2; border-radius:8px;
    box-shadow: 0 4px 6px rgba(0,0,0,.15), 0 10px 40px rgba(0,0,0,.3),
                0 0 0 1px rgba(0,0,0,.1), inset 0 1px 0 rgba(255,255,255,.9);
    max-width:420px; width:100%;
    transform:scale(.96) translateY(8px); opacity:0;
    transition:all .22s cubic-bezier(.34,1.56,.64,1); overflow:hidden;
    font-family:'Segoe UI','Poppins',sans-serif;
}
.win10-modal-overlay.active .win10-modal { transform:scale(1) translateY(0); opacity:1; }

.win10-titlebar {
    height:32px; display:flex; align-items:center;
    justify-content:space-between; padding:0 12px 0 14px; user-select:none;
}
.win10-titlebar.titlebar-info    { background:linear-gradient(135deg,#0078d4,#005a9e); }
.win10-titlebar.titlebar-success { background:linear-gradient(135deg,#107c10,#0b5e0b); }
.win10-titlebar.titlebar-error   { background:linear-gradient(135deg,#c42b1c,#9a1f14); }
.win10-titlebar.titlebar-match   { background:linear-gradient(135deg,var(--primary),var(--secondary)); }

.win10-titlebar-text  { color:white; font-size:12px; font-weight:600; flex:1; }
.win10-titlebar-icon  { width:16px; height:16px; margin-right:8px; flex-shrink:0; }

.win10-close-btn {
    width:46px; height:32px; background:transparent; border:none;
    cursor:pointer; color:white;
    display:flex; align-items:center; justify-content:center;
    margin-right:-12px; transition:background .15s;
}
.win10-close-btn:hover { background:#e81123; }
.win10-close-btn svg { width:10px; height:10px; }

.win10-modal-body { padding:20px 24px 16px; display:flex; gap:16px; align-items:flex-start; }
.win10-modal-icon-wrap {
    width:48px; height:48px; flex-shrink:0;
    display:flex; align-items:center; justify-content:center;
    border-radius:50%; margin-top:2px;
}
.win10-modal-icon-wrap.icon-info    { background:rgba(0,120,212,.12); }
.win10-modal-icon-wrap.icon-success { background:rgba(16,124,16,.12); }
.win10-modal-icon-wrap.icon-error   { background:rgba(196,43,28,.12); }
.win10-modal-icon-wrap svg { width:28px; height:28px; }
.win10-modal-icon-wrap.icon-info    svg { color:#0078d4; }
.win10-modal-icon-wrap.icon-success svg { color:#107c10; }
.win10-modal-icon-wrap.icon-error   svg { color:#c42b1c; }

.win10-modal-content { flex:1; }
.win10-modal-title   { font-size:15px; font-weight:700; color:#1a1a1a; margin-bottom:6px; line-height:1.3; }
.win10-modal-message { font-size:13.5px; color:#444; line-height:1.55; margin:0; }

.win10-modal-input-wrap { padding:0 24px 12px; }
.win10-modal-input {
    width:100%; padding:.7rem 1rem;
    border:1.5px solid #c8c8c8; border-radius:4px;
    font-size:.9rem; background:white; color:#1a1a1a;
    font-family:inherit; transition:border-color .2s;
}
.win10-modal-input:focus { outline:none; border-color: var(--primary); box-shadow:0 0 0 3px rgba(124,58,237,.15); }

.win10-modal-footer {
    background:#e8e8e8; border-top:1px solid #d0d0d0;
    padding:10px 16px; display:flex; justify-content:flex-end; gap:8px;
}
.win10-btn {
    min-width:88px; padding:6px 16px;
    border:1px solid #adadad; border-radius:3px;
    background:linear-gradient(to bottom,#f4f4f4,#e8e8e8);
    color:#1a1a1a; font-size:13px; font-weight:500; cursor:pointer;
    font-family:'Segoe UI','Poppins',sans-serif; transition:all .12s ease;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.8), 0 1px 2px rgba(0,0,0,.1);
}
.win10-btn:hover { background:linear-gradient(to bottom,#ede9fe,#ddd6fe); border-color: var(--primary); }
.win10-btn:active { box-shadow:inset 0 1px 2px rgba(0,0,0,.15); }

.win10-btn-primary {
    background:linear-gradient(to bottom, var(--primary), var(--primary-dark));
    color:white; border-color: var(--primary-dark);
    box-shadow:inset 0 1px 0 rgba(255,255,255,.2), 0 1px 2px rgba(0,0,0,.2);
}
.win10-btn-primary:hover { background:linear-gradient(to bottom,#8b5cf6,var(--primary)); color:white; border-color:var(--primary-dark); }

.win10-btn-danger {
    background:linear-gradient(to bottom,#d43030,#b52020);
    color:white; border-color:#8c1515;
    box-shadow:inset 0 1px 0 rgba(255,255,255,.2), 0 1px 2px rgba(0,0,0,.2);
}
.win10-btn-danger:hover { background:linear-gradient(to bottom,#e03535,#c42525); color:white; }

/* ================================================
   TOAST
   ================================================ */
.toast {
    position:fixed; top:2rem; left:50%;
    transform:translateX(-50%) translateY(-100px);
    background: var(--bg-surface);
    color:white;
    padding:1rem 1.5rem; border-radius: var(--radius-lg);
    box-shadow:0 10px 30px rgba(0,0,0,.4);
    z-index:2000; opacity:0; transition:all .3s ease;
    font-weight:600; max-width:90%;
    border: 1px solid var(--border-color);
}
.toast.show    { opacity:1; transform:translateX(-50%) translateY(0); }
.toast.success { background:linear-gradient(135deg,var(--primary),var(--secondary)); border-color:transparent; }
.toast.error   { background: var(--danger); border-color:transparent; }

/* ── Spinner ───────────────────────────────────── */
@keyframes spin { to { transform:rotate(360deg); } }
.btn.loading { color:transparent; pointer-events:none; }
.btn.loading::after {
    content:''; position:absolute; top:50%; left:50%;
    transform:translate(-50%,-50%);
    width:22px; height:22px;
    border:3px solid rgba(255,255,255,.3); border-radius:50%;
    border-top-color:white; animation:spin 1s linear infinite;
}
.hidden { display:none !important; }

@media (max-width:480px) {
    .app-title { font-size:2.5rem; }
    .screen-title { font-size:1.6rem; }
    .cards-stack { height:440px; }
    .action-btn { width:62px; height:62px; }
    .sidebar { width:85%; max-width:300px; }
    .win10-modal { max-width:96vw; }
}
</style>
</head>
<body>
<div id="app" class="app-container">

    <!-- LOGIN -->
    <div id="login-screen" class="screen active">
        <div class="login-container">
            <div class="logo-section">
                <div class="app-logo">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                    </svg>
                </div>
                <h1 class="app-title">LionMatch</h1>
                <p class="app-subtitle">Conecta con personas en León, Gto</p>
            </div>

            <form id="login-form" class="auth-form">
                <div class="form-group">
                    <label for="login-email">Correo electrónico</label>
                    <input type="email" id="login-email" autocomplete="email" required placeholder="tucorreo@ejemplo.com">
                </div>
                <div class="form-group">
                    <label for="login-password">Contraseña</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="login-password" autocomplete="current-password" required placeholder="••••••••">
                        <button type="button" class="toggle-password" data-target="login-password" aria-label="Mostrar contraseña">
                            <svg class="eye-open"   viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                            <svg class="eye-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"/><path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                        </button>
                    </div>
                </div>
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="age-confirmation" required>
                        <span>Confirmo que soy mayor de 18 años</span>
                    </label>
                </div>
                <button type="submit" class="btn btn-primary">Iniciar Sesión</button>
                <div class="divider"><span>o</span></div>
                <button type="button" class="btn btn-secondary" id="go-to-register">Crear cuenta nueva</button>
                <a href="#" class="forgot-password" id="forgot-password-link">¿Olvidaste tu contraseña?</a>
            </form>
        </div>
    </div>

    <!-- REGISTRO -->
    <div id="register-screen" class="screen">
        <div class="register-container">
            <button class="back-button" id="back-to-login">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            </button>
            <h2 class="screen-title">Crear Cuenta</h2>
            <p class="screen-subtitle">Únete a la comunidad de León</p>
            <form id="register-form" class="auth-form">
                <div class="form-group">
                    <label for="register-email">Correo electrónico</label>
                    <input type="email" id="register-email" autocomplete="email" required placeholder="tucorreo@ejemplo.com">
                </div>
                <div class="form-group">
                    <label for="register-password">Contraseña</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="register-password" autocomplete="new-password" required placeholder="••••••••" minlength="6">
                        <button type="button" class="toggle-password" data-target="register-password" aria-label="Mostrar contraseña">
                            <svg class="eye-open"   viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                            <svg class="eye-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"/><path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="register-password-confirm">Confirmar contraseña</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="register-password-confirm" autocomplete="new-password" required placeholder="••••••••" minlength="6">
                        <button type="button" class="toggle-password" data-target="register-password-confirm" aria-label="Mostrar contraseña">
                            <svg class="eye-open"   viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                            <svg class="eye-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"/><path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                        </button>
                    </div>
                </div>
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="register-age-confirmation" required>
                        <span>Confirmo que soy mayor de 18 años</span>
                    </label>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-register-accept">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="width:18px;height:18px;flex-shrink:0"><polyline points="20 6 9 17 4 12"/></svg>
                        Crear Cuenta
                    </button>
                    <button type="button" class="btn btn-register-cancel" id="cancel-register">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="width:18px;height:18px;flex-shrink:0"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ONBOARDING -->
    <div id="onboarding-screen" class="screen">
        <div class="onboarding-container">
            <button class="back-button" id="back-from-onboarding">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            </button>
            <div class="progress-bar"><div class="progress-fill" id="onboarding-progress"></div></div>
            <h2 class="screen-title">Completa tu Perfil</h2>
            <p class="screen-subtitle">Cuéntanos sobre ti</p>
            <form id="onboarding-form" class="auth-form">
                <div class="form-step active" data-step="1">
                    <div class="form-group">
                        <label for="profile-name">Nombre</label>
                        <input type="text" id="profile-name" required placeholder="Tu nombre">
                    </div>
                    <div class="form-group">
                        <label for="profile-birthdate">Fecha de nacimiento</label>
                        <input type="date" id="profile-birthdate" required>
                    </div>
                    <div class="form-group">
                        <label for="profile-gender">Género</label>
                        <select id="profile-gender" required>
                            <option value="">Selecciona</option>
                            <option value="Hombre">Hombre</option>
                            <option value="Mujer">Mujer</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>
                </div>
                <div class="form-step" data-step="2">
                    <div class="form-group">
                        <label>¿Qué buscas?</label>
                        <div class="button-group">
                            <button type="button" class="choice-btn" data-value="Hombres">Hombres</button>
                            <button type="button" class="choice-btn" data-value="Mujeres">Mujeres</button>
                            <button type="button" class="choice-btn" data-value="Todos">Todos</button>
                        </div>
                        <input type="hidden" id="profile-seeking" required>
                    </div>
                    <div class="form-group">
                        <label>Ubicación</label>
                        <div class="location-input-locked">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                            <input type="text" value="León, Guanajuato" disabled>
                        </div>
                        <p class="help-text">Tu ubicación está bloqueada en León, Gto para conectar con personas locales</p>
                    </div>
                </div>
                <div class="form-step" data-step="3">
                    <div class="form-group">
                        <label for="profile-bio">Biografía</label>
                        <textarea id="profile-bio" rows="4" placeholder="Cuéntanos sobre ti..." maxlength="300"></textarea>
                        <span class="char-count"><span id="bio-count">0</span>/300</span>
                    </div>
                    <div class="form-group">
                        <label for="profile-interests">Intereses</label>
                        <input type="text" id="profile-interests" placeholder="Ej: Fotografía, Deportes, Música">
                    </div>
                </div>
                <div class="form-navigation">
                    <button type="button" class="btn btn-secondary" id="prev-step" style="display:none">Anterior</button>
                    <button type="button" class="btn btn-primary"   id="next-step">Siguiente</button>
                    <button type="submit" class="btn btn-success"   id="complete-profile" style="display:none">Completar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- DESCUBRIMIENTO -->
    <div id="discovery-screen" class="screen">
        <header class="app-header">
            <button class="menu-btn" id="open-menu">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
            </button>
            <span class="header-logo">LionMatch</span>
            <div class="header-location">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
            </div>
        </header>
        <div class="discovery-container">
            <div class="cards-stack" id="cards-stack">
                <div class="no-more-cards" id="no-more-cards" style="display:none">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                    <h3>No hay más perfiles</h3>
                    <p>¡Vuelve más tarde!</p>
                </div>
            </div>
            <div class="action-buttons">
                <button class="action-btn dislike-btn" id="dislike-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
                <button class="action-btn like-btn" id="like-btn">
                    <svg viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- MENSAJES -->
    <div id="messages-screen" class="screen">
        <header class="app-header">
            <button class="menu-btn" id="messages-menu-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
            </button>
            <span class="header-title">Mensajes</span>
            <div style="width:40px"></div>
        </header>
        <div class="messages-container">
            <div class="matches-carousel" id="matches-carousel"></div>
            <div class="conversations-list" id="conversations-list">
                <div class="empty-state" id="empty-messages">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    <h3>Sin mensajes aún</h3>
                    <p>Tus conversaciones aparecerán aquí</p>
                </div>
            </div>
        </div>
    </div>

    <!-- CHAT -->
    <div id="chat-screen" class="screen">
        <div class="chat-header">
            <button class="back-button" id="back-from-chat" style="margin:0">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            </button>
            <div class="chat-user-info">
                <img src="" alt="avatar" class="chat-avatar" id="chat-user-avatar">
                <div>
                    <h3 id="chat-user-name">Usuario</h3>
                    <span class="online-status">En línea</span>
                </div>
            </div>
        </div>
        <div class="chat-messages" id="chat-messages"></div>
        <div class="chat-input-container">
            <input type="text" id="chat-input" placeholder="Escribe un mensaje...">
            <button class="send-btn" id="send-message-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
            </button>
        </div>
    </div>

    <!-- PERFIL -->
    <div id="profile-screen" class="screen">
        <header class="app-header">
            <button class="menu-btn" id="profile-menu-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
            </button>
            <span class="header-title">Mi Perfil</span>
            <div style="width:40px"></div>
        </header>
        <div class="profile-container">
            <div class="profile-card">
                <div class="profile-photo">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                </div>
                <h2 id="profile-display-name">Nombre</h2>
                <p class="profile-age" id="profile-display-age">Edad</p>
            </div>
            <div class="profile-info">
                <div class="info-section"><h3>Sobre mí</h3><p id="profile-display-bio">Sin biografía</p></div>
                <div class="info-section"><h3>Intereses</h3><p id="profile-display-interests">Sin intereses</p></div>
                <div class="info-section"><h3>Busco</h3><p id="profile-display-seeking">No especificado</p></div>
            </div>
            <div class="profile-actions">
                <button class="btn btn-primary" id="edit-profile-btn">Editar perfil</button>
                <button class="btn btn-danger"  id="delete-account-btn">Eliminar cuenta</button>
            </div>
        </div>
    </div>

    <!-- EDITAR PERFIL -->
    <div id="edit-profile-screen" class="screen">
        <div class="edit-profile-container">
            <button class="back-button" id="back-from-edit">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            </button>
            <h2 class="screen-title">Editar Perfil</h2>
            <p class="screen-subtitle">Actualiza tu información</p>
            <form id="edit-profile-form" class="auth-form">
                <div class="form-group">
                    <label for="edit-name">Nombre</label>
                    <input type="text" id="edit-name" required placeholder="Tu nombre">
                </div>
                <div class="form-group">
                    <label for="edit-bio">Biografía</label>
                    <textarea id="edit-bio" rows="4" placeholder="Cuéntanos sobre ti..." maxlength="300"></textarea>
                    <span class="char-count"><span id="edit-bio-count">0</span>/300</span>
                </div>
                <div class="form-group">
                    <label for="edit-interests">Intereses</label>
                    <input type="text" id="edit-interests" placeholder="Ej: Fotografía, Deportes, Música">
                </div>
                <div class="form-group">
                    <label>¿Qué buscas?</label>
                    <div class="button-group">
                        <button type="button" class="choice-btn" data-value="Hombres">Hombres</button>
                        <button type="button" class="choice-btn" data-value="Mujeres">Mujeres</button>
                        <button type="button" class="choice-btn" data-value="Todos">Todos</button>
                    </div>
                    <input type="hidden" id="edit-seeking">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Guardar cambios</button>
                    <button type="button" class="btn btn-secondary" id="cancel-edit">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- SIDEBAR -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h2>LionMatch</h2>
            <p>León, Guanajuato</p>
            <button class="close-sidebar" id="close-sidebar">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" data-screen="discovery">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                Descubrir
            </a>
            <a href="#" class="nav-item" data-screen="messages">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                Mensajes
            </a>
            <a href="#" class="nav-item" data-screen="profile">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                Mi Perfil
            </a>
        </nav>
        <div class="sidebar-footer">
            <button class="logout-btn" id="logout-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                Cerrar Sesión
            </button>
        </div>
    </div>
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <div id="toast" class="toast"></div>

    <!-- MODAL: Eliminar cuenta -->
    <div id="delete-modal" class="win10-modal-overlay">
        <div class="win10-modal">
            <div class="win10-titlebar titlebar-error">
                <svg class="win10-titlebar-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
                <span class="win10-titlebar-text">Eliminar cuenta</span>
                <button class="win10-close-btn" data-close-modal="delete-modal"><svg viewBox="0 0 10 10" fill="none" stroke="white" stroke-width="1.5"><line x1="1" y1="1" x2="9" y2="9"/><line x1="9" y1="1" x2="1" y2="9"/></svg></button>
            </div>
            <div class="win10-modal-body">
                <div class="win10-modal-icon-wrap icon-error">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                </div>
                <div class="win10-modal-content">
                    <p class="win10-modal-title">¿Eliminar tu cuenta?</p>
                    <p class="win10-modal-message">Esta acción es permanente y no se puede deshacer. Se eliminarán todos tus datos, matches y mensajes.</p>
                </div>
            </div>
            <div class="win10-modal-footer">
                <button class="win10-btn" data-close-modal="delete-modal" id="cancel-delete">Cancelar</button>
                <button class="win10-btn win10-btn-danger" id="confirm-delete">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Error -->
    <div id="win10-error-modal" class="win10-modal-overlay">
        <div class="win10-modal">
            <div class="win10-titlebar titlebar-error">
                <svg class="win10-titlebar-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                <span class="win10-titlebar-text" id="win10-error-title">Error</span>
                <button class="win10-close-btn" data-close-modal="win10-error-modal"><svg viewBox="0 0 10 10" fill="none" stroke="white" stroke-width="1.5"><line x1="1" y1="1" x2="9" y2="9"/><line x1="9" y1="1" x2="1" y2="9"/></svg></button>
            </div>
            <div class="win10-modal-body">
                <div class="win10-modal-icon-wrap icon-error">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                </div>
                <div class="win10-modal-content">
                    <p class="win10-modal-title" id="win10-error-title-inner">Ha ocurrido un error</p>
                    <p class="win10-modal-message" id="win10-error-message">Mensaje de error aquí.</p>
                </div>
            </div>
            <div class="win10-modal-footer">
                <button class="win10-btn win10-btn-danger" data-close-modal="win10-error-modal">Aceptar</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Éxito -->
    <div id="win10-success-modal" class="win10-modal-overlay">
        <div class="win10-modal">
            <div class="win10-titlebar titlebar-success">
                <svg class="win10-titlebar-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                <span class="win10-titlebar-text" id="win10-success-title">Operación exitosa</span>
                <button class="win10-close-btn" data-close-modal="win10-success-modal"><svg viewBox="0 0 10 10" fill="none" stroke="white" stroke-width="1.5"><line x1="1" y1="1" x2="9" y2="9"/><line x1="9" y1="1" x2="1" y2="9"/></svg></button>
            </div>
            <div class="win10-modal-body">
                <div class="win10-modal-icon-wrap icon-success">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                </div>
                <div class="win10-modal-content">
                    <p class="win10-modal-title" id="win10-success-title-inner">¡Éxito!</p>
                    <p class="win10-modal-message" id="win10-success-message">La operación fue exitosa.</p>
                </div>
            </div>
            <div class="win10-modal-footer">
                <button class="win10-btn win10-btn-primary" id="win10-success-ok-btn" data-close-modal="win10-success-modal">Aceptar</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Recuperar contraseña -->
    <div id="win10-recovery-modal" class="win10-modal-overlay">
        <div class="win10-modal">
            <div class="win10-titlebar titlebar-info">
                <svg class="win10-titlebar-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                <span class="win10-titlebar-text">Recuperar contraseña</span>
                <button class="win10-close-btn" data-close-modal="win10-recovery-modal"><svg viewBox="0 0 10 10" fill="none" stroke="white" stroke-width="1.5"><line x1="1" y1="1" x2="9" y2="9"/><line x1="9" y1="1" x2="1" y2="9"/></svg></button>
            </div>
            <div class="win10-modal-body">
                <div class="win10-modal-icon-wrap icon-info">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                </div>
                <div class="win10-modal-content">
                    <p class="win10-modal-title">Restablecer contraseña</p>
                    <p class="win10-modal-message">Ingresa tu correo y te enviaremos un enlace para restablecer tu contraseña.</p>
                </div>
            </div>
            <div class="win10-modal-input-wrap">
                <input type="email" class="win10-modal-input" id="win10-recovery-email" placeholder="tucorreo@ejemplo.com">
            </div>
            <div class="win10-modal-footer">
                <button class="win10-btn" data-close-modal="win10-recovery-modal">Cancelar</button>
                <button class="win10-btn win10-btn-primary" id="send-recovery-btn">Enviar</button>
            </div>
        </div>
    </div>

    <!-- MODAL: Match -->
    <div id="match-modal" class="win10-modal-overlay">
        <div class="win10-modal">
            <div class="win10-titlebar titlebar-match">
                <svg class="win10-titlebar-icon" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                <span class="win10-titlebar-text">¡Es un Match!</span>
                <button class="win10-close-btn" id="close-match-modal" data-close-modal="match-modal"><svg viewBox="0 0 10 10" fill="none" stroke="white" stroke-width="1.5"><line x1="1" y1="1" x2="9" y2="9"/><line x1="9" y1="1" x2="1" y2="9"/></svg></button>
            </div>
            <div class="win10-modal-body" style="flex-direction:column;align-items:center;text-align:center;gap:12px">
                <img id="match-user-photo" src="" alt="Match" style="width:90px;height:90px;border-radius:50%;object-fit:cover;border:3px solid #7c3aed;margin-top:8px">
                <div class="win10-modal-content" style="text-align:center">
                    <p class="win10-modal-title" style="font-size:18px">¡Han hecho Match! 🎉</p>
                    <p class="win10-modal-message">Los dos se gustaron. ¡Empieza la conversación ahora!</p>
                </div>
            </div>
            <div class="win10-modal-footer">
                <button class="win10-btn" data-close-modal="match-modal" id="close-match-modal-btn">Después</button>
                <button class="win10-btn win10-btn-primary" id="send-match-message">Enviar mensaje</button>
            </div>
        </div>
    </div>

</div><!-- /#app -->

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// ================================================
// LIONMATCH - LÓGICA PRINCIPAL
// Correcciones:
//  1. Ojito: listener delegado en document (funciona en cualquier pantalla)
//  2. Botón "Crear cuenta nueva": listener directo con verificación de existencia
//  3. Fondo blanco eliminado, todo usa paleta oscura
// ================================================

const SUPABASE_URL      = 'https://fjevgfyqqsfankvledpl.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZqZXZnZnlxcXNmYW5rdmxlZHBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2Nzk0NjIsImV4cCI6MjA4NjI1NTQ2Mn0.AmysLsRq_KBXYculm0Nyw3a0abWLQ8zTt-2OSo-6PSA';
const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let currentUser         = null;
let currentScreen       = 'login';
let onboardingStep      = 1;
let profiles            = [];
let currentProfileIndex = 0;
let matches             = [];
let conversations       = [];

// ── Init ────────────────────────────────────────
document.addEventListener('DOMContentLoaded', initializeApp);

async function initializeApp() {
    // ── FIX OJITO: delegación en document ──────
    // Esto garantiza que funcione sin importar en qué pantalla esté el botón
    document.addEventListener('click', function(e) {
        const btn = e.target.closest('.toggle-password');
        if (!btn) return;
        e.preventDefault();
        e.stopPropagation();

        const targetId  = btn.getAttribute('data-target');
        const input     = document.getElementById(targetId);
        if (!input) return;

        const eyeOpen   = btn.querySelector('.eye-open');
        const eyeClosed = btn.querySelector('.eye-closed');

        if (input.type === 'password') {
            input.type = 'text';
            if (eyeOpen)   eyeOpen.style.display   = 'none';
            if (eyeClosed) eyeClosed.style.display = 'block';
            btn.setAttribute('aria-label', 'Ocultar contraseña');
        } else {
            input.type = 'password';
            if (eyeOpen)   eyeOpen.style.display   = 'block';
            if (eyeClosed) eyeClosed.style.display = 'none';
            btn.setAttribute('aria-label', 'Mostrar contraseña');
        }
    });

    // ── Verificar sesión activa ─────────────────
    const { data: { session } } = await supabase.auth.getSession();
    if (session) {
        currentUser = session.user;
        await loadUserProfile();
        const { data: profile } = await supabase
            .from('profiles').select('*').eq('user_id', currentUser.id).single();
        if (profile && profile.name) { showScreen('discovery'); await loadProfiles(); }
        else { showScreen('onboarding'); }
    } else {
        showScreen('login');
    }

    initializeEventListeners();
}

// ── Event listeners ─────────────────────────────
function initializeEventListeners() {

    // LOGIN
    document.getElementById('login-form')?.addEventListener('submit', handleLogin);

    // ── FIX BOTÓN REGISTRO ──
    // Se busca cada vez que se va a usar, no en el primer render
    const goToRegisterBtn = document.getElementById('go-to-register');
    if (goToRegisterBtn) {
        goToRegisterBtn.addEventListener('click', () => {
            showScreen('register');
        });
    }

    document.getElementById('forgot-password-link')?.addEventListener('click', handleForgotPassword);

    // REGISTRO
    document.getElementById('register-form')?.addEventListener('submit', handleRegister);
    document.getElementById('back-to-login')?.addEventListener('click', () => showScreen('login'));
    document.getElementById('cancel-register')?.addEventListener('click', () => showScreen('login'));

    // Bio counters
    const bioInput = document.getElementById('profile-bio');
    bioInput?.addEventListener('input', () => {
        document.getElementById('bio-count').textContent = bioInput.value.length;
    });
    const editBioInput = document.getElementById('edit-bio');
    editBioInput?.addEventListener('input', () => {
        document.getElementById('edit-bio-count').textContent = editBioInput.value.length;
    });

    // Choice buttons (¿Qué buscas?)
    document.querySelectorAll('.choice-btn').forEach(btn => {
        btn.addEventListener('click', function() {
            const group       = this.parentElement;
            const hiddenInput = group.nextElementSibling;
            group.querySelectorAll('.choice-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            if (hiddenInput && hiddenInput.tagName === 'INPUT') {
                hiddenInput.value = this.getAttribute('data-value');
            }
        });
    });

    // ONBOARDING
    document.getElementById('onboarding-form')?.addEventListener('submit', handleCompleteProfile);
    document.getElementById('next-step')?.addEventListener('click', nextOnboardingStep);
    document.getElementById('prev-step')?.addEventListener('click', prevOnboardingStep);
    document.getElementById('back-from-onboarding')?.addEventListener('click', handleLogout);

    // DISCOVERY
    document.getElementById('like-btn')?.addEventListener('click',    () => handleSwipe('like'));
    document.getElementById('dislike-btn')?.addEventListener('click', () => handleSwipe('dislike'));

    // SIDEBAR
    document.querySelectorAll('#open-menu, #messages-menu-btn, #profile-menu-btn').forEach(btn => {
        btn.addEventListener('click', openSidebar);
    });
    document.getElementById('close-sidebar')?.addEventListener('click', closeSidebar);
    document.getElementById('sidebar-overlay')?.addEventListener('click', closeSidebar);

    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            const screen = item.getAttribute('data-screen');
            closeSidebar();
            showScreen(screen);
            if (screen === 'discovery') loadProfiles();
            else if (screen === 'messages') { loadMatches(); loadConversations(); }
            else if (screen === 'profile')  displayUserProfile();
        });
    });

    // PERFIL
    document.getElementById('edit-profile-btn')?.addEventListener('click', () => {
        populateEditForm(); showScreen('edit-profile');
    });
    document.getElementById('delete-account-btn')?.addEventListener('click', () => {
        document.getElementById('delete-modal').classList.add('active');
    });
    document.getElementById('confirm-delete')?.addEventListener('click', handleDeleteAccount);
    document.getElementById('cancel-delete')?.addEventListener('click',  () => hideWin10Modal('delete-modal'));

    // EDITAR PERFIL
    document.getElementById('edit-profile-form')?.addEventListener('submit', handleUpdateProfile);
    document.getElementById('back-from-edit')?.addEventListener('click', () => showScreen('profile'));
    document.getElementById('cancel-edit')?.addEventListener('click',    () => showScreen('profile'));

    // CHAT
    document.getElementById('back-from-chat')?.addEventListener('click', () => showScreen('messages'));
    document.getElementById('send-message-btn')?.addEventListener('click', handleSendMessage);
    document.getElementById('chat-input')?.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleSendMessage();
    });

    // LOGOUT
    document.getElementById('logout-btn')?.addEventListener('click', handleLogout);

    // Modales - cerrar al click en overlay
    document.querySelectorAll('.win10-modal-overlay').forEach(overlay => {
        overlay.addEventListener('click', (e) => {
            if (e.target === overlay) overlay.classList.remove('active');
        });
    });
    document.querySelectorAll('[data-close-modal]').forEach(btn => {
        btn.addEventListener('click', () => hideWin10Modal(btn.getAttribute('data-close-modal')));
    });

    // Recuperar contraseña
    document.getElementById('send-recovery-btn')?.addEventListener('click', handlePasswordRecovery);

    // Match modal
    document.getElementById('send-match-message')?.addEventListener('click', () => {
        hideWin10Modal('match-modal');
        showScreen('chat');
    });
}

// ── Modales Win10 ────────────────────────────────
function showWin10Modal(id) { document.getElementById(id)?.classList.add('active'); }
function hideWin10Modal(id) { document.getElementById(id)?.classList.remove('active'); }

function showErrorWin10(msg, title = 'Error') {
    document.getElementById('win10-error-title').textContent       = title;
    document.getElementById('win10-error-title-inner').textContent = title;
    document.getElementById('win10-error-message').textContent     = msg;
    showWin10Modal('win10-error-modal');
}
function showSuccessWin10(msg, title = 'Operación exitosa') {
    document.getElementById('win10-success-title').textContent       = title;
    document.getElementById('win10-success-title-inner').textContent = title;
    document.getElementById('win10-success-message').textContent     = msg;
    showWin10Modal('win10-success-modal');
}

// ── Autenticación ────────────────────────────────
async function handleLogin(e) {
    e.preventDefault();
    const email    = document.getElementById('login-email').value;
    const password = document.getElementById('login-password').value;
    if (!document.getElementById('age-confirmation').checked) {
        showToast('Debes confirmar que eres mayor de edad', 'error'); return;
    }
    try {
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) throw error;
        currentUser = data.user;
        await loadUserProfile();
        showToast('¡Bienvenido de nuevo!', 'success');
        showScreen('discovery');
        await loadProfiles();
    } catch (err) {
        console.error(err);
        showToast('Email o contraseña incorrectos', 'error');
    }
}

async function handleRegister(e) {
    e.preventDefault();
    const email    = document.getElementById('register-email').value.trim();
    const pw       = document.getElementById('register-password').value;
    const pwc      = document.getElementById('register-password-confirm').value;
    const ageOk    = document.getElementById('register-age-confirmation').checked;

    if (!ageOk)                   { showErrorWin10('Debes confirmar que eres mayor de 18 años.', 'Verificación de edad'); return; }
    if (!email.includes('@'))     { showErrorWin10('Ingresa un correo electrónico válido.', 'Correo inválido'); return; }
    if (pw.length < 6)            { showErrorWin10('La contraseña debe tener al menos 6 caracteres.', 'Contraseña muy corta'); return; }
    if (pw !== pwc)               { showErrorWin10('Las contraseñas no coinciden.', 'Contraseñas distintas'); return; }

    const btn = document.querySelector('#register-form .btn-register-accept');
    if (btn) { btn.classList.add('loading'); btn.disabled = true; }

    try {
        const { data: existing } = await supabase.from('profiles').select('user_id').eq('email', email).maybeSingle();
        if (existing) {
            showErrorWin10(`El correo "${email}" ya está registrado.\nIntenta iniciar sesión.`, 'Cuenta ya existente'); return;
        }

        const { data, error } = await supabase.auth.signUp({
            email, password: pw,
            options: { data: { email }, emailRedirectTo: 'https://flavioalejandrov24-lang.github.io/Citasyparejasleongto/' }
        });
        if (error) {
            const m = (error.message || '').toLowerCase();
            if (m.includes('already') || m.includes('exists')) {
                showErrorWin10(`El correo "${email}" ya tiene una cuenta.`, 'Cuenta ya existente');
            } else {
                showErrorWin10(error.message || 'Error al crear la cuenta.', 'Error de registro');
            }
            return;
        }
        if (data?.user?.identities?.length === 0) {
            showErrorWin10(`El correo "${email}" ya está registrado.`, 'Cuenta ya existente'); return;
        }

        currentUser = data.user;
        await supabase.from('profiles').insert({ user_id: currentUser.id, email, created_at: new Date().toISOString() });

        showSuccessWin10(
            `¡Cuenta creada! Revisa tu correo "${email}" para confirmarla.`,
            'Registro exitoso'
        );
        const okBtn = document.getElementById('win10-success-ok-btn');
        const goOn  = () => { hideWin10Modal('win10-success-modal'); showScreen('onboarding'); okBtn.removeEventListener('click', goOn); };
        okBtn?.addEventListener('click', goOn);
    } catch (err) {
        console.error(err);
        showErrorWin10('Error inesperado. Intenta nuevamente.', 'Error de registro');
    } finally {
        if (btn) { btn.classList.remove('loading'); btn.disabled = false; }
    }
}

async function handleForgotPassword(e) {
    e.preventDefault();
    document.getElementById('win10-recovery-email').value = '';
    showWin10Modal('win10-recovery-modal');
}
async function handlePasswordRecovery() {
    const email   = document.getElementById('win10-recovery-email').value.trim();
    if (!email.includes('@')) { showErrorWin10('Ingresa un correo válido.', 'Correo inválido'); return; }
    const btn = document.getElementById('send-recovery-btn');
    if (btn) { btn.disabled = true; btn.textContent = 'Enviando...'; }
    try {
        const { error } = await supabase.auth.resetPasswordForEmail(email, {
            redirectTo: 'https://flavioalejandrov24-lang.github.io/Citasyparejasleongto/'
        });
        if (error) throw error;
        hideWin10Modal('win10-recovery-modal');
        showSuccessWin10(`Enlace enviado a "${email}". Revisa también spam.`, 'Correo enviado');
    } catch (err) {
        showErrorWin10('No se pudo enviar el correo.', 'Error al enviar');
    } finally {
        if (btn) { btn.disabled = false; btn.textContent = 'Enviar'; }
    }
}
async function handleLogout() {
    await supabase.auth.signOut();
    currentUser = null;
    showScreen('login');
    showToast('Sesión cerrada', 'success');
}

// ── Onboarding ───────────────────────────────────
function nextOnboardingStep() {
    const step   = document.querySelector(`.form-step[data-step="${onboardingStep}"]`);
    const inputs = step.querySelectorAll('input[required], select[required]');
    let valid = true;
    inputs.forEach(inp => {
        if (!inp.value) { valid = false; inp.style.borderColor = 'var(--danger)'; setTimeout(() => inp.style.borderColor = '', 2000); }
    });
    if (!valid) { showToast('Completa todos los campos', 'error'); return; }
    if (onboardingStep < 3) { onboardingStep++; updateOnboardingUI(); }
}
function prevOnboardingStep() {
    if (onboardingStep > 1) { onboardingStep--; updateOnboardingUI(); }
}
function updateOnboardingUI() {
    document.querySelectorAll('.form-step').forEach(s => s.classList.remove('active'));
    document.querySelector(`.form-step[data-step="${onboardingStep}"]`).classList.add('active');
    document.getElementById('onboarding-progress').style.width  = `${(onboardingStep/3)*100}%`;
    document.getElementById('prev-step').style.display           = onboardingStep > 1 ? 'block' : 'none';
    document.getElementById('next-step').style.display           = onboardingStep < 3 ? 'block' : 'none';
    document.getElementById('complete-profile').style.display    = onboardingStep === 3 ? 'block' : 'none';
}
async function handleCompleteProfile(e) {
    e.preventDefault();
    const name      = document.getElementById('profile-name').value;
    const birthdate = document.getElementById('profile-birthdate').value;
    const gender    = document.getElementById('profile-gender').value;
    const seeking   = document.getElementById('profile-seeking').value;
    const bio       = document.getElementById('profile-bio').value || '';
    const interests = document.getElementById('profile-interests').value || '';
    const age       = calculateAge(birthdate);
    if (age < 18) { showToast('Debes ser mayor de 18 años', 'error'); return; }
    if (!seeking)  { showToast('Selecciona qué buscas', 'error'); return; }
    try {
        const { error } = await supabase.from('profiles').update({
            name, birthdate, age, gender, seeking, bio, interests,
            location: 'León, Guanajuato', updated_at: new Date().toISOString()
        }).eq('user_id', currentUser.id);
        if (error) throw error;
        await loadUserProfile();
        showToast('¡Perfil completado!', 'success');
        showScreen('discovery');
        await loadProfiles();
    } catch (err) { console.error(err); showToast('Error al guardar el perfil', 'error'); }
}

// ── Perfil ───────────────────────────────────────
async function loadUserProfile() {
    try {
        const { data } = await supabase.from('profiles').select('*').eq('user_id', currentUser.id).single();
        currentUser.profile = data;
    } catch (err) { console.error(err); }
}
function displayUserProfile() {
    const p = currentUser.profile;
    document.getElementById('profile-display-name').textContent      = p.name;
    document.getElementById('profile-display-age').textContent       = `${p.age} años`;
    document.getElementById('profile-display-bio').textContent       = p.bio || 'Sin biografía';
    document.getElementById('profile-display-interests').textContent = p.interests || 'Sin intereses';
    document.getElementById('profile-display-seeking').textContent   = p.seeking || 'No especificado';
}
function populateEditForm() {
    const p = currentUser.profile;
    document.getElementById('edit-name').value      = p.name || '';
    document.getElementById('edit-bio').value       = p.bio  || '';
    document.getElementById('edit-interests').value = p.interests || '';
    document.getElementById('edit-seeking').value   = p.seeking || '';
    document.getElementById('edit-bio-count').textContent = (p.bio || '').length;
    document.querySelectorAll('#edit-profile-screen .choice-btn').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-value') === p.seeking);
    });
}
async function handleUpdateProfile(e) {
    e.preventDefault();
    const name      = document.getElementById('edit-name').value;
    const bio       = document.getElementById('edit-bio').value;
    const interests = document.getElementById('edit-interests').value;
    const seeking   = document.getElementById('edit-seeking').value;
    if (!seeking) { showToast('Selecciona qué buscas', 'error'); return; }
    try {
        const { error } = await supabase.from('profiles').update({
            name, bio, interests, seeking, updated_at: new Date().toISOString()
        }).eq('user_id', currentUser.id);
        if (error) throw error;
        await loadUserProfile();
        showToast('Perfil actualizado', 'success');
        showScreen('profile');
        displayUserProfile();
    } catch (err) { console.error(err); showToast('Error al actualizar', 'error'); }
}
async function handleDeleteAccount() {
    try {
        await supabase.from('profiles').delete().eq('user_id', currentUser.id);
        await supabase.from('likes').delete().or(`user_id.eq.${currentUser.id},liked_user_id.eq.${currentUser.id}`);
        await supabase.from('matches').delete().or(`user1_id.eq.${currentUser.id},user2_id.eq.${currentUser.id}`);
        await supabase.from('messages').delete().or(`sender_id.eq.${currentUser.id},receiver_id.eq.${currentUser.id}`);
        await supabase.auth.admin.deleteUser(currentUser.id);
        currentUser = null;
        hideWin10Modal('delete-modal');
        showScreen('login');
        showToast('Cuenta eliminada', 'success');
    } catch (err) { console.error(err); showToast('Error al eliminar. Contacta soporte.', 'error'); }
}

// ── Descubrimiento ───────────────────────────────
async function loadProfiles() {
    try {
        const myProfile = currentUser.profile;
        const { data: liked } = await supabase.from('likes').select('liked_user_id').eq('user_id', currentUser.id);
        const excludeIds = (liked || []).map(l => l.liked_user_id);
        excludeIds.push(currentUser.id);

        let query = supabase.from('profiles').select('*')
            .eq('location', 'León, Guanajuato')
            .not('user_id', 'in', `(${excludeIds.join(',')})`);
        if (myProfile.seeking !== 'Todos') {
            query = query.eq('gender', myProfile.seeking === 'Hombres' ? 'Hombre' : 'Mujer');
        }
        const { data, error } = await query.limit(20);
        if (error) throw error;
        profiles = data || [];
        currentProfileIndex = 0;
        renderCurrentProfile();
    } catch (err) { console.error(err); showToast('Error al cargar perfiles', 'error'); }
}
function renderCurrentProfile() {
    const stack = document.getElementById('cards-stack');
    stack.innerHTML = '';
    if (currentProfileIndex >= profiles.length) {
        document.getElementById('no-more-cards').style.display = 'flex'; return;
    }
    const p    = profiles[currentProfileIndex];
    const card = document.createElement('div');
    card.className = 'profile-card-swipe';
    card.innerHTML = `
        <img src="https://i.pravatar.cc/400?u=${p.user_id}" alt="${p.name}">
        <div class="profile-card-info">
            <h3>${p.name}, ${p.age}</h3>
            <p>${p.bio || 'Sin biografía'}</p>
        </div>
        <div class="swipe-indicator like">LIKE</div>
        <div class="swipe-indicator nope">NOPE</div>`;
    stack.appendChild(card);

    let startX = 0, currentX = 0, dragging = false;
    const onStart = e => { dragging = true; startX = e.touches ? e.touches[0].clientX : e.clientX; card.style.transition = 'none'; };
    const onMove  = e => {
        if (!dragging) return;
        currentX = e.touches ? e.touches[0].clientX : e.clientX;
        const d  = currentX - startX;
        card.style.transform = `translateX(${d}px) rotate(${d*0.1}deg)`;
        card.querySelector('.swipe-indicator.like').classList.toggle('show', d > 50);
        card.querySelector('.swipe-indicator.nope').classList.toggle('show', d < -50);
    };
    const onEnd = () => {
        if (!dragging) return; dragging = false;
        const d = currentX - startX;
        card.style.transition = 'transform .3s ease';
        if (d > 100) handleSwipe('like', card);
        else if (d < -100) handleSwipe('dislike', card);
        else {
            card.style.transform = '';
            card.querySelector('.swipe-indicator.like').classList.remove('show');
            card.querySelector('.swipe-indicator.nope').classList.remove('show');
        }
    };
    card.addEventListener('mousedown', onStart); card.addEventListener('touchstart', onStart);
    card.addEventListener('mousemove', onMove);  card.addEventListener('touchmove', onMove);
    card.addEventListener('mouseup', onEnd);     card.addEventListener('touchend', onEnd);
    card.addEventListener('mouseleave', onEnd);
}
async function handleSwipe(action, cardEl = null) {
    const p = profiles[currentProfileIndex];
    if (!cardEl) cardEl = document.querySelector('.profile-card-swipe');
    cardEl.style.transform = action === 'like' ? 'translateX(150%) rotate(30deg)' : 'translateX(-150%) rotate(-30deg)';
    setTimeout(() => { currentProfileIndex++; renderCurrentProfile(); }, 300);
    try {
        await supabase.from('likes').insert({
            user_id: currentUser.id, liked_user_id: p.user_id,
            is_like: action === 'like', created_at: new Date().toISOString()
        });
        if (action === 'like') {
            const { data: rec } = await supabase.from('likes').select('*')
                .eq('user_id', p.user_id).eq('liked_user_id', currentUser.id).eq('is_like', true).single();
            if (rec) { await createMatch(p); showMatchModal(p); }
        }
    } catch (err) { console.error(err); }
}
async function createMatch(p) {
    try {
        await supabase.from('matches').insert({ user1_id: currentUser.id, user2_id: p.user_id, created_at: new Date().toISOString() });
    } catch (err) { console.error(err); }
}
function showMatchModal(p) {
    document.getElementById('match-user-photo').src = `https://i.pravatar.cc/150?u=${p.user_id}`;
    showWin10Modal('match-modal');
}

// ── Mensajes ─────────────────────────────────────
async function loadMatches() {
    try {
        const { data, error } = await supabase.from('matches').select(`
            *, user1:profiles!matches_user1_id_fkey(*), user2:profiles!matches_user2_id_fkey(*)
        `).or(`user1_id.eq.${currentUser.id},user2_id.eq.${currentUser.id}`)
          .order('created_at', { ascending: false });
        if (error) throw error;
        matches = data || [];
        renderMatches();
    } catch (err) { console.error(err); }
}
function renderMatches() {
    const c = document.getElementById('matches-carousel'); c.innerHTML = '';
    matches.forEach(m => {
        const u   = m.user1_id === currentUser.id ? m.user2 : m.user1;
        const div = document.createElement('div');
        div.className = 'match-item';
        div.innerHTML = `<img src="https://i.pravatar.cc/100?u=${u.user_id}" alt="${u.name}" class="match-avatar"><div class="match-name">${u.name}</div>`;
        div.addEventListener('click', () => openChat(u));
        c.appendChild(div);
    });
}
async function loadConversations() {
    try {
        const { data, error } = await supabase.from('messages').select(`
            *, sender:profiles!messages_sender_id_fkey(*), receiver:profiles!messages_receiver_id_fkey(*)
        `).or(`sender_id.eq.${currentUser.id},receiver_id.eq.${currentUser.id}`)
          .order('created_at', { ascending: false }).limit(50);
        if (error) throw error;
        const map = new Map();
        (data || []).forEach(msg => {
            const oid = msg.sender_id === currentUser.id ? msg.receiver_id : msg.sender_id;
            if (!map.has(oid)) map.set(oid, {
                user: msg.sender_id === currentUser.id ? msg.receiver : msg.sender,
                lastMessage: msg.content, time: formatTime(msg.created_at), online: Math.random() > .5
            });
        });
        conversations = Array.from(map.values());
        renderConversations();
    } catch (err) { console.error(err); }
}
function renderConversations() {
    const list = document.getElementById('conversations-list');
    if (!conversations.length) {
        list.innerHTML = `<div class="empty-state"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><h3>Sin mensajes aún</h3><p>Tus conversaciones aparecerán aquí</p></div>`;
        return;
    }
    list.innerHTML = '';
    conversations.forEach(cv => {
        const div = document.createElement('div');
        div.className = 'conversation-item';
        div.innerHTML = `
            <div class="conversation-avatar-wrapper">
                <img src="https://i.pravatar.cc/100?u=${cv.user.user_id}" alt="${cv.user.name}" class="conversation-avatar">
                ${cv.online ? '<div class="online-indicator"></div>' : ''}
            </div>
            <div class="conversation-info">
                <div class="conversation-header">
                    <span class="conversation-name">${cv.user.name}</span>
                    <span class="conversation-time">${cv.time}</span>
                </div>
                <p class="conversation-message">${cv.lastMessage}</p>
            </div>`;
        div.addEventListener('click', () => openChat(cv.user));
        list.appendChild(div);
    });
}
function openChat(user) {
    showScreen('chat');
    document.getElementById('chat-user-avatar').src        = `https://i.pravatar.cc/100?u=${user.user_id}`;
    document.getElementById('chat-user-name').textContent  = user.name;
    loadChatMessages(user.user_id);
}
async function loadChatMessages(otherId) {
    try {
        const { data } = await supabase.from('messages').select('*')
            .or(`and(sender_id.eq.${currentUser.id},receiver_id.eq.${otherId}),and(sender_id.eq.${otherId},receiver_id.eq.${currentUser.id})`)
            .order('created_at', { ascending: true });
        const c = document.getElementById('chat-messages'); c.innerHTML = '';
        (data || []).forEach(msg => {
            const d = document.createElement('div');
            d.className = `message ${msg.sender_id === currentUser.id ? 'sent' : 'received'}`;
            d.innerHTML = `<div class="message-bubble">${msg.content}</div>`;
            c.appendChild(d);
        });
        c.scrollTop = c.scrollHeight;
    } catch (err) { console.error(err); }
}
async function handleSendMessage() {
    const input   = document.getElementById('chat-input');
    const content = input.value.trim();
    if (!content) return;
    const name  = document.getElementById('chat-user-name').textContent;
    const other = conversations.find(c => c.user.name === name)?.user;
    if (!other) return;
    try {
        await supabase.from('messages').insert({ sender_id: currentUser.id, receiver_id: other.user_id, content, created_at: new Date().toISOString() });
        input.value = '';
        loadChatMessages(other.user_id);
    } catch (err) { console.error(err); showToast('Error al enviar', 'error'); }
}

// ── Utilidades ───────────────────────────────────
function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(`${screenId}-screen`)?.classList.add('active');
    currentScreen = screenId;
}
function showToast(msg, type = 'success') {
    const t = document.getElementById('toast');
    t.textContent = msg; t.className = `toast ${type}`;
    t.classList.add('show');
    setTimeout(() => t.classList.remove('show'), 3000);
}
function openSidebar()  { document.getElementById('sidebar').classList.add('open'); document.getElementById('sidebar-overlay').classList.add('active'); }
function closeSidebar() { document.getElementById('sidebar').classList.remove('open'); document.getElementById('sidebar-overlay').classList.remove('active'); }
function calculateAge(birthdate) {
    const today = new Date(), birth = new Date(birthdate);
    let age = today.getFullYear() - birth.getFullYear();
    const m = today.getMonth() - birth.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < birth.getDate())) age--;
    return age;
}
function formatTime(ts) {
    const date = new Date(ts), now = new Date(), diff = now - date;
    const m = Math.floor(diff/60000), h = Math.floor(diff/3600000), d = Math.floor(diff/86400000);
    if (m < 1)  return 'Ahora';
    if (m < 60) return `${m}m`;
    if (h < 24) return `${h}h`;
    if (d < 7)  return `${d}d`;
    return date.toLocaleDateString('es-MX', { day:'numeric', month:'short' });
}
</script>
</body>
</html>
