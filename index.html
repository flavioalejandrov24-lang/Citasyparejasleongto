<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LionMatch - Conecta en León, GTO</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700;800;900&display=swap" rel="stylesheet">

<style>
/* ================================================
   LIONMATCH - ESTILOS PRINCIPALES
   NUEVA PALETA: Índigo profundo + Rosa coral + Amber
   ================================================ */

* { margin: 0; padding: 0; box-sizing: border-box; }

:root {
    /* ── Nueva paleta ── */
    --primary:       #7c3aed;   /* violeta índigo vibrante */
    --primary-dark:  #5b21b6;
    --primary-light: #a78bfa;
    --secondary:     #ec4899;   /* rosa coral */
    --accent:        #f59e0b;   /* amber dorado */
    /* ── Fondos ── */
    --bg-dark:  #0f0a1e;        /* noche profunda */
    --bg-mid:   #1a1033;
    --bg-light: #f5f3ff;        /* lavanda muy claro */
    --bg-card:  #ffffff;
    /* ── Textos ── */
    --text-dark:  #1e1b4b;
    --text-light: #6b7280;
    --text-white: #ffffff;
    /* ── Semánticos ── */
    --success: #10b981;
    --danger:  #ef4444;
    --warning: #f59e0b;
    --info:    #3b82f6;
    /* ── Sombras ── */
    --shadow-sm: 0 1px 2px rgba(0,0,0,.05);
    --shadow-md: 0 4px 6px -1px rgba(0,0,0,.1);
    --shadow-lg: 0 10px 15px -3px rgba(0,0,0,.1);
    --shadow-xl: 0 20px 25px -5px rgba(0,0,0,.1);
    --shadow-glow: 0 0 40px rgba(124,58,237,.35);
    /* ── Bordes ── */
    --radius-sm: .5rem;
    --radius-md: 1rem;
    --radius-lg: 1.5rem;
    --radius-xl: 2rem;
    --transition: all .3s ease;
}

body {
    font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
    background: var(--bg-light);
    color: var(--text-dark);
    line-height: 1.6;
    -webkit-font-smoothing: antialiased;
    overflow-x: hidden;
}

.app-container {
    max-width: 480px;
    margin: 0 auto;
    background: var(--bg-card);
    min-height: 100vh;
    position: relative;
    box-shadow: 0 0 60px rgba(124,58,237,.12);
}

/* ── Pantallas ─────────────────────────────────── */
.screen {
    position: absolute;
    top: 0; left: 0;
    width: 100%; min-height: 100vh;
    background: var(--bg-card);
    opacity: 0; pointer-events: none;
    transform: translateX(100%);
    transition: transform .4s cubic-bezier(.4,0,.2,1), opacity .4s ease;
}
.screen.active  { opacity: 1; pointer-events: all; transform: translateX(0); }
.screen.slide-left { transform: translateX(-100%); }

/* ================================================
   LOGIN
   ================================================ */
#login-screen {
    background: linear-gradient(135deg, var(--bg-dark) 0%, var(--bg-mid) 60%, #2d1b4e 100%);
    display: flex; align-items: center; justify-content: center;
    padding: 2rem; position: relative; overflow: hidden;
}
#login-screen::before {
    content: '';
    position: absolute; top: -50%; left: -50%;
    width: 200%; height: 200%;
    background:
        radial-gradient(circle at 30% 30%, rgba(124,58,237,.18) 0%, transparent 55%),
        radial-gradient(circle at 70% 70%, rgba(236,72,153,.14) 0%, transparent 55%);
    animation: pulse 8s ease-in-out infinite;
}
@keyframes pulse {
    0%,100% { transform: scale(1); opacity: .6; }
    50%      { transform: scale(1.08); opacity: 1; }
}

.login-container { width: 100%; max-width: 400px; position: relative; z-index: 1; }

.logo-section { text-align: center; margin-bottom: 3rem; animation: fadeInDown .6s ease; }
@keyframes fadeInDown {
    from { opacity: 0; transform: translateY(-30px); }
    to   { opacity: 1; transform: translateY(0); }
}

.app-logo {
    width: 84px; height: 84px;
    margin: 0 auto 1.5rem;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    border-radius: var(--radius-xl);
    display: flex; align-items: center; justify-content: center;
    box-shadow: var(--shadow-glow);
    animation: float 3s ease-in-out infinite;
}
@keyframes float {
    0%,100% { transform: translateY(0) rotate(3deg); }
    50%     { transform: translateY(-10px) rotate(-3deg); }
}
.app-logo svg { width: 40px; height: 40px; color: white; fill: white; }

.app-title {
    font-size: 3rem; font-weight: 900; font-style: italic;
    background: linear-gradient(135deg, white 0%, var(--primary-light) 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent;
    background-clip: text; margin-bottom: .5rem; letter-spacing: -.05em;
}
.app-subtitle { color: rgba(255,255,255,.7); font-size: 1.1rem; font-weight: 500; }

/* ── Formularios ───────────────────────────────── */
.auth-form { animation: fadeInUp .6s ease .2s both; }
@keyframes fadeInUp {
    from { opacity: 0; transform: translateY(30px); }
    to   { opacity: 1; transform: translateY(0); }
}

.form-group { margin-bottom: 1.5rem; }

.form-group label {
    display: block; margin-bottom: .5rem;
    color: var(--text-white); font-weight: 600; font-size: .9rem;
}
#register-screen .form-group label,
#onboarding-screen .form-group label,
#edit-profile-screen .form-group label { color: var(--text-dark); }

.form-group input,
.form-group select,
.form-group textarea {
    width: 100%; padding: 1rem 1.25rem;
    border: 2px solid rgba(255,255,255,.1);
    border-radius: var(--radius-md);
    background: rgba(255,255,255,.05);
    color: var(--text-white); font-size: 1rem;
    font-family: inherit; transition: var(--transition);
    backdrop-filter: blur(10px);
}
#register-screen .form-group input,
#register-screen .form-group select,
#register-screen .form-group textarea,
#onboarding-screen .form-group input,
#onboarding-screen .form-group select,
#onboarding-screen .form-group textarea,
#edit-profile-screen .form-group input,
#edit-profile-screen .form-group select,
#edit-profile-screen .form-group textarea {
    background: var(--bg-light); color: var(--text-dark); border-color: #ddd6fe;
}
.form-group input:focus,
.form-group select:focus,
.form-group textarea:focus {
    outline: none; border-color: var(--primary);
    background: rgba(255,255,255,.1);
    box-shadow: 0 0 0 4px rgba(124,58,237,.15);
}
#register-screen .form-group input:focus,
#register-screen .form-group select:focus,
#register-screen .form-group textarea:focus,
#onboarding-screen .form-group input:focus,
#onboarding-screen .form-group select:focus,
#onboarding-screen .form-group textarea:focus,
#edit-profile-screen .form-group input:focus,
#edit-profile-screen .form-group select:focus,
#edit-profile-screen .form-group textarea:focus { background: white; }

.form-group input::placeholder,
.form-group textarea::placeholder { color: rgba(255,255,255,.45); }
#register-screen .form-group input::placeholder,
#register-screen .form-group textarea::placeholder,
#onboarding-screen .form-group input::placeholder,
#onboarding-screen .form-group textarea::placeholder,
#edit-profile-screen .form-group input::placeholder,
#edit-profile-screen .form-group textarea::placeholder { color: #9ca3af; }

/* ── Toggle password ───────────────────────────── */
.password-input-wrapper { position: relative; }
.password-input-wrapper input { padding-right: 3.5rem; }
.toggle-password {
    position: absolute; right: 1rem; top: 50%;
    transform: translateY(-50%);
    background: none; border: none; cursor: pointer;
    padding: .5rem; color: rgba(255,255,255,.55);
    transition: var(--transition);
    display: flex; align-items: center; justify-content: center;
}
#register-screen .toggle-password,
#onboarding-screen .toggle-password,
#edit-profile-screen .toggle-password { color: var(--text-light); }
.toggle-password:hover { color: var(--primary); transform: translateY(-50%) scale(1.15); }
.toggle-password .eye-open,
.toggle-password .eye-closed { width: 22px; height: 22px; display: block; pointer-events: none; }

/* ── Checkbox ──────────────────────────────────── */
.checkbox-group { display: flex; align-items: center; }
.checkbox-label {
    display: flex; align-items: center; gap: .75rem;
    cursor: pointer; color: var(--text-white); font-size: .9rem; user-select: none;
}
.checkbox-label input[type="checkbox"] { width: 20px; height: 20px; cursor: pointer; accent-color: var(--primary); }

/* ── Botones ───────────────────────────────────── */
.btn {
    width: 100%; padding: 1.25rem 2rem; border: none;
    border-radius: var(--radius-md); font-size: 1rem; font-weight: 700;
    text-transform: uppercase; letter-spacing: .05em;
    cursor: pointer; transition: var(--transition);
    font-family: inherit; display: inline-flex;
    align-items: center; justify-content: center; gap: .5rem;
}
.btn svg { width: 20px; height: 20px; }

.btn-primary {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color: white; box-shadow: 0 10px 25px rgba(124,58,237,.35);
}
.btn-primary:hover { transform: translateY(-2px); box-shadow: 0 15px 35px rgba(124,58,237,.45); }
.btn-primary:active { transform: translateY(0); }

.btn-secondary {
    background: rgba(255,255,255,.1); color: var(--text-white);
    border: 2px solid rgba(255,255,255,.2); backdrop-filter: blur(10px);
}
#register-screen .btn-secondary,
#onboarding-screen .btn-secondary,
#edit-profile-screen .btn-secondary {
    background: var(--bg-light); color: var(--text-dark); border-color: #ddd6fe;
}
.btn-secondary:hover { background: rgba(255,255,255,.15); border-color: rgba(255,255,255,.3); }
#register-screen .btn-secondary:hover,
#onboarding-screen .btn-secondary:hover,
#edit-profile-screen .btn-secondary:hover { background: #ede9fe; }

.btn-success { background: var(--primary); color: white; box-shadow: var(--shadow-lg); }
.btn-success:hover { background: var(--primary-dark); transform: translateY(-2px); box-shadow: var(--shadow-xl); }

.btn-danger  { background: var(--danger); color: white; box-shadow: var(--shadow-lg); }
.btn-danger:hover { background: #dc2626; transform: translateY(-2px); box-shadow: var(--shadow-xl); }

/* ── Botones traslúcidos registro ──────────────── */
.btn-register-accept {
    background: rgba(124,58,237,.13);
    color: #5b21b6;
    border: 2px solid rgba(124,58,237,.5);
    backdrop-filter: blur(12px);
    box-shadow: 0 4px 20px rgba(124,58,237,.2), inset 0 1px 0 rgba(255,255,255,.3);
    font-weight: 700; letter-spacing: .04em; transition: all .25s ease;
}
.btn-register-accept:hover {
    background: rgba(124,58,237,.25); border-color: rgba(124,58,237,.8);
    box-shadow: 0 8px 28px rgba(124,58,237,.35), inset 0 1px 0 rgba(255,255,255,.4);
    transform: translateY(-2px); color: #4c1d95;
}
.btn-register-accept:active { transform: translateY(0); background: rgba(124,58,237,.2); }
.btn-register-accept.loading { color: transparent; pointer-events: none; position: relative; }
.btn-register-accept.loading::after {
    content: ''; position: absolute; top: 50%; left: 50%;
    transform: translate(-50%,-50%);
    width: 22px; height: 22px;
    border: 3px solid rgba(124,58,237,.25); border-radius: 50%;
    border-top-color: #5b21b6; animation: spin 1s linear infinite;
}

.btn-register-cancel {
    background: rgba(239,68,68,.1); color: #dc2626;
    border: 2px solid rgba(239,68,68,.42);
    backdrop-filter: blur(12px);
    box-shadow: 0 4px 20px rgba(239,68,68,.14), inset 0 1px 0 rgba(255,255,255,.25);
    font-weight: 700; letter-spacing: .04em; transition: all .25s ease;
}
.btn-register-cancel:hover {
    background: rgba(239,68,68,.2); border-color: rgba(239,68,68,.75);
    box-shadow: 0 8px 28px rgba(239,68,68,.28), inset 0 1px 0 rgba(255,255,255,.3);
    transform: translateY(-2px); color: #b91c1c;
}
.btn-register-cancel:active { transform: translateY(0); background: rgba(239,68,68,.17); }

.form-actions {
    display: grid; grid-template-columns: 1fr 1fr;
    gap: 1rem; margin-top: 2rem; position: relative;
}

/* ── Olvidé contraseña ─────────────────────────── */
.forgot-password {
    display: block; text-align: center;
    color: var(--primary-light); text-decoration: none;
    margin: 1rem 0; font-size: .9rem; font-weight: 500;
    transition: var(--transition);
}
.forgot-password:hover { color: var(--secondary); }

.divider { margin: 2rem 0; text-align: center; position: relative; }
.divider::before {
    content: ''; position: absolute; top: 50%;
    left: 0; right: 0; height: 1px; background: rgba(255,255,255,.1);
}
.divider span {
    position: relative; background: var(--bg-dark);
    padding: 0 1rem; color: rgba(255,255,255,.5); font-size: .9rem; font-weight: 500;
}

/* ================================================
   REGISTRO / ONBOARDING / EDITAR PERFIL
   ================================================ */
#register-screen,
#onboarding-screen,
#edit-profile-screen { background: var(--bg-light); }

.register-container,
.onboarding-container,
.edit-profile-container { padding: 2rem; max-width: 480px; margin: 0 auto; }

.screen-title { font-size: 2rem; font-weight: 800; color: var(--text-dark); margin-bottom: .5rem; }
.screen-subtitle { color: var(--text-light); margin-bottom: 2rem; }

.back-button {
    background: white; border: none;
    width: 44px; height: 44px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; margin-bottom: 1.5rem;
    transition: var(--transition); box-shadow: var(--shadow-sm);
}
.back-button:hover { background: #ede9fe; transform: scale(1.05); }
.back-button svg { width: 20px; height: 20px; color: var(--text-dark); }

/* ── Onboarding ────────────────────────────────── */
.progress-bar { height: 4px; background: #ddd6fe; border-radius: 2px; margin-bottom: 2rem; overflow: hidden; }
.progress-fill {
    height: 100%; width: 33.33%; transition: width .3s ease;
    background: linear-gradient(90deg, var(--primary) 0%, var(--secondary) 100%);
}

.form-step { display: none; }
.form-step.active { display: block; animation: fadeIn .3s ease; }
@keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }

.button-group { display: grid; grid-template-columns: repeat(auto-fit,minmax(120px,1fr)); gap: .75rem; }

.choice-btn {
    padding: 1rem; border: 2px solid #ddd6fe;
    background: white; border-radius: var(--radius-md);
    font-weight: 600; color: var(--text-light); cursor: pointer; transition: var(--transition);
}
.choice-btn:hover { border-color: var(--primary); color: var(--primary); }
.choice-btn.active { background: var(--primary); color: white; border-color: var(--primary); }

.location-input-locked {
    display: flex; align-items: center; gap: .75rem;
    padding: 1rem 1.25rem; background: #ede9fe;
    border: 2px solid #ddd6fe; border-radius: var(--radius-md);
}
.location-input-locked svg { width: 20px; height: 20px; color: var(--primary); }
.location-input-locked input { flex: 1; background: none; border: none; padding: 0; color: var(--primary-dark); font-weight: 600; }

.help-text { margin-top: .5rem; font-size: .85rem; color: var(--text-light); }
.char-count { display: block; text-align: right; font-size: .85rem; color: var(--text-light); margin-top: .25rem; }

.form-navigation { display: flex; gap: 1rem; margin-top: 2rem; }
.form-navigation .btn { flex: 1; }

/* ================================================
   HEADER
   ================================================ */
.app-header {
    display: flex; align-items: center; justify-content: space-between;
    padding: 1rem 1.5rem; background: white;
    border-bottom: 1px solid #f5f3ff;
    position: sticky; top: 0; z-index: 50;
}
.menu-btn {
    background: none; border: none; width: 40px; height: 40px;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; border-radius: var(--radius-sm); transition: var(--transition);
}
.menu-btn:hover { background: #f5f3ff; }
.menu-btn svg { width: 24px; height: 24px; color: var(--text-dark); }

.header-logo {
    font-size: 1.5rem; font-weight: 900; font-style: italic;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    -webkit-background-clip: text; -webkit-text-fill-color: transparent; background-clip: text;
}
.header-title { font-size: 1.25rem; font-weight: 700; color: var(--text-dark); }
.header-location { width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; }
.header-location svg { width: 24px; height: 24px; color: var(--primary); }

/* ================================================
   DESCUBRIMIENTO
   ================================================ */
.discovery-container { padding: 2rem 1.5rem 6rem; position: relative; }

.cards-stack { position: relative; width: 100%; height: 500px; margin-bottom: 2rem; }

.profile-card-swipe {
    position: absolute; width: 100%; height: 100%;
    border-radius: var(--radius-xl); overflow: hidden;
    box-shadow: 0 10px 40px rgba(0,0,0,.15); cursor: grab;
    transition: transform .3s ease, box-shadow .3s ease;
}
.profile-card-swipe:active { cursor: grabbing; }
.profile-card-swipe img { width: 100%; height: 100%; object-fit: cover; }

.profile-card-info {
    position: absolute; bottom: 0; left: 0; right: 0;
    padding: 2rem;
    background: linear-gradient(to top, rgba(0,0,0,.82) 0%, transparent 100%);
    color: white;
}
.profile-card-info h3 { font-size: 1.75rem; font-weight: 800; margin-bottom: .5rem; }
.profile-card-info p { font-size: .95rem; opacity: .9; line-height: 1.5; }

.swipe-indicator {
    position: absolute; top: 2rem;
    padding: 1rem 2rem; border-radius: var(--radius-lg);
    font-weight: 800; font-size: 1.5rem; text-transform: uppercase;
    opacity: 0; transition: opacity .3s ease; pointer-events: none;
}
.swipe-indicator.like  { right: 2rem; background: var(--primary); color: white; border: 3px solid white; transform: rotate(15deg); }
.swipe-indicator.nope  { left:  2rem; background: var(--danger);  color: white; border: 3px solid white; transform: rotate(-15deg); }
.swipe-indicator.show  { opacity: 1; }

.no-more-cards {
    display: flex; flex-direction: column; align-items: center;
    justify-content: center; height: 100%; text-align: center; padding: 2rem;
}
.no-more-cards svg { width: 80px; height: 80px; color: var(--primary); margin-bottom: 1.5rem; stroke-width: 1.5; }
.no-more-cards h3 { font-size: 1.5rem; font-weight: 700; color: var(--text-dark); margin-bottom: .5rem; }
.no-more-cards p { color: var(--text-light); }

.action-buttons { display: flex; justify-content: center; gap: 2rem; }
.action-btn {
    width: 70px; height: 70px; border-radius: 50%; border: none;
    background: white; box-shadow: 0 5px 20px rgba(0,0,0,.15);
    cursor: pointer; transition: var(--transition);
    display: flex; align-items: center; justify-content: center;
}
.action-btn:hover  { transform: scale(1.1); }
.action-btn:active { transform: scale(.95); }
.dislike-btn svg { width: 30px; height: 30px; color: var(--danger); stroke-width: 2.5; }
.like-btn { background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); }
.like-btn svg { width: 32px; height: 32px; color: white; stroke-width: 2.5; }

/* ================================================
   MENSAJES
   ================================================ */
.messages-container { padding: 1rem; }
.matches-carousel {
    display: flex; gap: 1rem; overflow-x: auto;
    padding: 1rem 0; margin-bottom: 1.5rem; scrollbar-width: none;
}
.matches-carousel::-webkit-scrollbar { display: none; }

.match-item { flex-shrink: 0; text-align: center; cursor: pointer; }
.match-avatar {
    width: 70px; height: 70px; border-radius: 50%; object-fit: cover;
    border: 3px solid var(--primary); margin-bottom: .5rem; transition: var(--transition);
}
.match-item:hover .match-avatar { transform: scale(1.05); }
.match-name { font-size: .85rem; font-weight: 600; color: var(--text-dark); }

.conversations-list { min-height: 400px; }
.conversation-item {
    display: flex; align-items: center; gap: 1rem;
    padding: 1rem; border-radius: var(--radius-md);
    cursor: pointer; transition: var(--transition); margin-bottom: .5rem;
}
.conversation-item:hover { background: var(--bg-light); }

.conversation-avatar-wrapper { position: relative; }
.conversation-avatar { width: 60px; height: 60px; border-radius: 50%; object-fit: cover; }
.online-indicator {
    position: absolute; bottom: 2px; right: 2px;
    width: 14px; height: 14px; background: var(--success);
    border: 2px solid white; border-radius: 50%;
}
.conversation-info { flex: 1; min-width: 0; }
.conversation-header { display: flex; justify-content: space-between; align-items: center; margin-bottom: .25rem; }
.conversation-name  { font-weight: 700; color: var(--text-dark); }
.conversation-time  { font-size: .8rem; color: var(--text-light); }
.conversation-message { color: var(--text-light); font-size: .9rem; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }

.empty-state { display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 4rem 2rem; text-align: center; }
.empty-state svg { width: 60px; height: 60px; color: var(--text-light); margin-bottom: 1rem; stroke-width: 1.5; }
.empty-state h3 { font-size: 1.25rem; font-weight: 700; color: var(--text-dark); margin-bottom: .5rem; }
.empty-state p { color: var(--text-light); }

/* ================================================
   CHAT
   ================================================ */
.chat-header {
    display: flex; align-items: center; gap: 1rem;
    padding: 1rem 1.5rem; background: white; border-bottom: 1px solid #f5f3ff;
}
.chat-user-info { display: flex; align-items: center; gap: 1rem; flex: 1; }
.chat-avatar { width: 45px; height: 45px; border-radius: 50%; object-fit: cover; }
.chat-user-info h3 { font-size: 1rem; font-weight: 700; color: var(--text-dark); }
.online-status { font-size: .8rem; color: var(--success); }

.chat-messages {
    flex: 1; overflow-y: auto; padding: 1.5rem;
    background: var(--bg-light); min-height: calc(100vh - 140px);
}
.message { display: flex; margin-bottom: 1rem; animation: messageSlideIn .3s ease; }
@keyframes messageSlideIn {
    from { opacity: 0; transform: translateY(10px); }
    to   { opacity: 1; transform: translateY(0); }
}
.message.sent { justify-content: flex-end; }
.message-bubble { max-width: 70%; padding: .75rem 1rem; border-radius: var(--radius-md); font-size: .95rem; }
.message.received .message-bubble { background: white; color: var(--text-dark); border-bottom-left-radius: 4px; }
.message.sent     .message-bubble {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color: white; border-bottom-right-radius: 4px;
}

.chat-input-container { display: flex; gap: .75rem; padding: 1rem 1.5rem; background: white; border-top: 1px solid #f5f3ff; }
.chat-input-container input {
    flex: 1; padding: .75rem 1rem;
    border: 2px solid #ddd6fe; border-radius: var(--radius-lg);
    font-size: .95rem; font-family: inherit; transition: var(--transition);
}
.chat-input-container input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(124,58,237,.12); }
.send-btn {
    width: 45px; height: 45px; border-radius: 50%; border: none;
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color: white; display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: var(--transition);
}
.send-btn:hover { transform: scale(1.05); opacity: .9; }
.send-btn svg { width: 20px; height: 20px; }

/* ================================================
   PERFIL
   ================================================ */
.profile-container { padding: 1.5rem; }
.profile-card {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    border-radius: var(--radius-xl); padding: 3rem 2rem; text-align: center;
    color: white; margin-bottom: 1.5rem; box-shadow: 0 10px 30px rgba(124,58,237,.3);
}
.profile-photo {
    width: 120px; height: 120px; border-radius: 50%;
    background: rgba(255,255,255,.2); margin: 0 auto 1.5rem;
    display: flex; align-items: center; justify-content: center; border: 4px solid white;
}
.profile-photo svg { width: 60px; height: 60px; color: white; }
.profile-card h2 { font-size: 1.75rem; font-weight: 800; margin-bottom: .25rem; }
.profile-age { font-size: 1rem; opacity: .9; }

.profile-info {
    background: white; border-radius: var(--radius-lg);
    padding: 1.5rem; margin-bottom: 1.5rem; box-shadow: var(--shadow-sm);
}
.info-section { margin-bottom: 1.5rem; }
.info-section:last-child { margin-bottom: 0; }
.info-section h3 {
    font-size: .85rem; font-weight: 700; color: var(--primary);
    text-transform: uppercase; letter-spacing: .05em; margin-bottom: .5rem;
}
.info-section p { color: var(--text-dark); line-height: 1.6; }
.profile-actions { display: flex; flex-direction: column; gap: 1rem; }

/* ================================================
   SIDEBAR
   ================================================ */
.sidebar {
    position: fixed; top: 0; left: 0;
    width: 300px; height: 100%;
    background: white; box-shadow: 2px 0 30px rgba(124,58,237,.15);
    z-index: 100; transform: translateX(-100%); transition: transform .3s ease;
    display: flex; flex-direction: column;
}
.sidebar.open { transform: translateX(0); }

.sidebar-header {
    background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%);
    color: white; padding: 2rem 1.5rem; position: relative;
}
.sidebar-header h2 { font-size: 1.75rem; font-weight: 900; font-style: italic; margin-bottom: .25rem; }
.sidebar-header p  { font-size: .85rem; opacity: .9; }

.close-sidebar {
    position: absolute; top: 1rem; right: 1rem;
    background: rgba(255,255,255,.2); border: none;
    width: 36px; height: 36px; border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    cursor: pointer; transition: var(--transition);
}
.close-sidebar:hover { background: rgba(255,255,255,.35); }
.close-sidebar svg { width: 20px; height: 20px; color: white; }

.sidebar-nav { flex: 1; padding: 1.5rem; }
.nav-item {
    display: flex; align-items: center; gap: 1rem;
    padding: 1rem; border-radius: var(--radius-md);
    color: var(--text-dark); text-decoration: none;
    font-weight: 600; transition: var(--transition); margin-bottom: .5rem;
}
.nav-item:hover  { background: #f5f3ff; color: var(--primary); }
.nav-item.active { background: linear-gradient(135deg, var(--primary) 0%, var(--secondary) 100%); color: white; }
.nav-item svg { width: 22px; height: 22px; }

.sidebar-footer { padding: 1.5rem; border-top: 1px solid #f5f3ff; }
.logout-btn {
    width: 100%; padding: 1rem; background: none; border: none;
    color: var(--danger); font-weight: 600; font-size: .95rem;
    cursor: pointer; display: flex; align-items: center; justify-content: center;
    gap: .5rem; border-radius: var(--radius-md); transition: var(--transition);
}
.logout-btn:hover { background: rgba(239,68,68,.08); }
.logout-btn svg { width: 20px; height: 20px; }

.sidebar-overlay {
    position: fixed; top: 0; left: 0; width: 100%; height: 100%;
    background: rgba(15,10,30,.55); z-index: 99;
    opacity: 0; pointer-events: none; transition: opacity .3s ease;
}
.sidebar-overlay.active { opacity: 1; pointer-events: all; }

/* ================================================
   MODALES WIN10
   ================================================ */
.win10-modal-overlay {
    position: fixed; top: 0; left: 0; right: 0; bottom: 0;
    background: rgba(15,10,30,.6); backdrop-filter: blur(4px);
    display: flex; align-items: center; justify-content: center;
    z-index: 1000; opacity: 0; pointer-events: none;
    transition: opacity .25s ease; padding: 1rem;
}
.win10-modal-overlay.active { opacity: 1; pointer-events: all; }

.win10-modal {
    background: #f2f2f2; border-radius: 8px;
    box-shadow: 0 2px 4px rgba(0,0,0,.12), 0 8px 32px rgba(0,0,0,.22),
                0 0 0 1px rgba(0,0,0,.08), inset 0 1px 0 rgba(255,255,255,.9);
    max-width: 420px; width: 100%;
    transform: scale(.96) translateY(8px); opacity: 0;
    transition: all .2s cubic-bezier(.34,1.56,.64,1); overflow: hidden;
    font-family: 'Segoe UI','Poppins',sans-serif;
}
.win10-modal-overlay.active .win10-modal { transform: scale(1) translateY(0); opacity: 1; }

.win10-titlebar {
    height: 32px; display: flex; align-items: center;
    justify-content: space-between; padding: 0 12px 0 14px;
    user-select: none;
}
.win10-titlebar.titlebar-info    { background: linear-gradient(135deg,#0078d4,#005a9e); }
.win10-titlebar.titlebar-success { background: linear-gradient(135deg,#107c10,#0b5e0b); }
.win10-titlebar.titlebar-error   { background: linear-gradient(135deg,#c42b1c,#9a1f14); }
.win10-titlebar.titlebar-warning { background: linear-gradient(135deg,#ca5010,#a03e0c); }
/* También para modales de esta app, aprovechamos el color del brand */
.win10-titlebar.titlebar-match   { background: linear-gradient(135deg,var(--primary),var(--secondary)); }

.win10-titlebar-text  { color: white; font-size: 12px; font-weight: 600; letter-spacing: .01em; flex: 1; }
.win10-titlebar-icon  { width: 16px; height: 16px; margin-right: 8px; flex-shrink: 0; }

.win10-close-btn {
    width: 46px; height: 32px; background: transparent; border: none;
    cursor: pointer; color: white;
    display: flex; align-items: center; justify-content: center;
    margin-right: -12px; transition: background .15s;
}
.win10-close-btn:hover { background: #e81123; }
.win10-close-btn svg  { width: 10px; height: 10px; }

.win10-modal-body  { padding: 20px 24px 16px; display: flex; gap: 16px; align-items: flex-start; }
.win10-modal-icon-wrap {
    width: 48px; height: 48px; flex-shrink: 0;
    display: flex; align-items: center; justify-content: center;
    border-radius: 50%; margin-top: 2px;
}
.win10-modal-icon-wrap.icon-info    { background: rgba(0,120,212,.12); }
.win10-modal-icon-wrap.icon-success { background: rgba(16,124,16,.12); }
.win10-modal-icon-wrap.icon-error   { background: rgba(196,43,28,.12); }
.win10-modal-icon-wrap.icon-warning { background: rgba(202,80,16,.12); }
.win10-modal-icon-wrap svg { width: 28px; height: 28px; }
.win10-modal-icon-wrap.icon-info    svg { color: #0078d4; }
.win10-modal-icon-wrap.icon-success svg { color: #107c10; }
.win10-modal-icon-wrap.icon-error   svg { color: #c42b1c; }
.win10-modal-icon-wrap.icon-warning svg { color: #ca5010; }

.win10-modal-content { flex: 1; }
.win10-modal-title   { font-size: 15px; font-weight: 700; color: #1a1a1a; margin-bottom: 6px; line-height: 1.3; }
.win10-modal-message { font-size: 13.5px; color: #444; line-height: 1.55; margin: 0; }

.win10-modal-input-wrap { padding: 0 24px 12px; }
.win10-modal-input {
    width: 100%; padding: .7rem 1rem;
    border: 1.5px solid #c8c8c8; border-radius: 4px;
    font-size: .9rem; background: white;
    color: var(--text-dark); font-family: inherit; transition: border-color .2s;
}
.win10-modal-input:focus { outline: none; border-color: var(--primary); box-shadow: 0 0 0 3px rgba(124,58,237,.15); }

.win10-modal-footer {
    background: #e8e8e8; border-top: 1px solid #d0d0d0;
    padding: 10px 16px; display: flex; justify-content: flex-end; gap: 8px;
}
.win10-btn {
    min-width: 90px; padding: 6px 16px;
    border: 1px solid #adadad; border-radius: 3px;
    background: linear-gradient(to bottom,#f4f4f4,#e8e8e8);
    color: #1a1a1a; font-size: 13px; font-weight: 500;
    cursor: pointer; font-family: 'Segoe UI','Poppins',sans-serif;
    transition: all .12s ease;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.8), 0 1px 2px rgba(0,0,0,.1);
}
.win10-btn:hover { background: linear-gradient(to bottom,#ede9fe,#ddd6fe); border-color: var(--primary); }
.win10-btn:active { background: linear-gradient(to bottom,#ddd6fe,#c4b5fd); box-shadow: inset 0 1px 2px rgba(0,0,0,.15); }

.win10-btn-primary {
    background: linear-gradient(to bottom,var(--primary),var(--primary-dark));
    color: white; border-color: var(--primary-dark);
    box-shadow: inset 0 1px 0 rgba(255,255,255,.2), 0 1px 2px rgba(0,0,0,.2);
}
.win10-btn-primary:hover { background: linear-gradient(to bottom,#8b5cf6,var(--primary)); border-color: var(--primary-dark); color: white; }
.win10-btn-primary:active { background: linear-gradient(to bottom,var(--primary-dark),#4c1d95); color: white; }

.win10-btn-danger {
    background: linear-gradient(to bottom,#d43030,#b52020);
    color: white; border-color: #8c1515;
    box-shadow: inset 0 1px 0 rgba(255,255,255,.2), 0 1px 2px rgba(0,0,0,.2);
}
.win10-btn-danger:hover { background: linear-gradient(to bottom,#e03535,#c42525); color: white; }

/* ================================================
   TOAST
   ================================================ */
.toast {
    position: fixed; top: 2rem; left: 50%;
    transform: translateX(-50%) translateY(-100px);
    background: white; color: var(--text-dark);
    padding: 1rem 1.5rem; border-radius: var(--radius-lg);
    box-shadow: 0 10px 30px rgba(0,0,0,.2);
    z-index: 2000; opacity: 0; transition: all .3s ease;
    font-weight: 600; max-width: 90%;
}
.toast.show    { opacity: 1; transform: translateX(-50%) translateY(0); }
.toast.success { background: linear-gradient(135deg,var(--primary),var(--secondary)); color: white; }
.toast.error   { background: var(--danger); color: white; }

/* ── Loader ────────────────────────────────────── */
@keyframes spin { to { transform: rotate(360deg); } }
.btn.loading { position: relative; color: transparent; pointer-events: none; }
.btn.loading::after {
    content: ''; position: absolute; top: 50%; left: 50%;
    transform: translate(-50%,-50%);
    width: 22px; height: 22px;
    border: 3px solid rgba(255,255,255,.3); border-radius: 50%;
    border-top-color: white; animation: spin 1s linear infinite;
}
.hidden { display: none !important; }

/* ── Responsive ────────────────────────────────── */
@media (max-width: 480px) {
    .app-title { font-size: 2.5rem; }
    .screen-title { font-size: 1.75rem; }
    .profile-card-swipe { height: 450px; }
    .action-btn { width: 60px; height: 60px; }
    .sidebar { width: 85%; max-width: 300px; }
    .win10-modal { max-width: 96vw; }
}
</style>
</head>
<body>
<div id="app" class="app-container">

    <!-- ============================================ -->
    <!-- PANTALLA DE LOGIN                            -->
    <!-- ============================================ -->
    <div id="login-screen" class="screen active">
        <div class="login-container">
            <div class="logo-section">
                <div class="app-logo">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/>
                    </svg>
                </div>
                <h1 class="app-title">LionMatch</h1>
                <p class="app-subtitle">Conecta con personas en León, Gto</p>
            </div>

            <form id="login-form" class="auth-form">
                <div class="form-group">
                    <label for="login-email">Correo electrónico</label>
                    <input type="email" id="login-email" required placeholder="tucorreo@ejemplo.com">
                </div>
                <div class="form-group">
                    <label for="login-password">Contraseña</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="login-password" required placeholder="••••••••">
                        <button type="button" class="toggle-password" data-target="login-password" aria-label="Mostrar contraseña">
                            <svg class="eye-open" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                            <svg class="eye-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"/><path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                        </button>
                    </div>
                </div>
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="age-confirmation" required>
                        <span>Confirmo que soy mayor de 18 años</span>
                    </label>
                </div>
                <button type="submit" class="btn btn-primary">Iniciar Sesión</button>
                <div class="divider"><span>o</span></div>
                <button type="button" class="btn btn-secondary" id="go-to-register">Crear cuenta nueva</button>
                <a href="#" class="forgot-password" id="forgot-password-link">¿Olvidaste tu contraseña?</a>
            </form>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- PANTALLA DE REGISTRO                         -->
    <!-- ============================================ -->
    <div id="register-screen" class="screen">
        <div class="register-container">
            <button class="back-button" id="back-to-login">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            </button>
            <h2 class="screen-title">Crear Cuenta</h2>
            <p class="screen-subtitle">Únete a la comunidad de León</p>

            <form id="register-form" class="auth-form">
                <div class="form-group">
                    <label for="register-email">Correo electrónico</label>
                    <input type="email" id="register-email" required placeholder="tucorreo@ejemplo.com">
                </div>
                <div class="form-group">
                    <label for="register-password">Contraseña</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="register-password" required placeholder="••••••••" minlength="6">
                        <button type="button" class="toggle-password" data-target="register-password" aria-label="Mostrar contraseña">
                            <svg class="eye-open" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                            <svg class="eye-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"/><path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                        </button>
                    </div>
                </div>
                <div class="form-group">
                    <label for="register-password-confirm">Confirmar contraseña</label>
                    <div class="password-input-wrapper">
                        <input type="password" id="register-password-confirm" required placeholder="••••••••" minlength="6">
                        <button type="button" class="toggle-password" data-target="register-password-confirm" aria-label="Mostrar contraseña">
                            <svg class="eye-open" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M1 12s4-8 11-8 11 8 11 8-4 8-11 8-11-8-11-8z"/><circle cx="12" cy="12" r="3"/></svg>
                            <svg class="eye-closed" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" style="display:none;"><path d="M17.94 17.94A10.07 10.07 0 0 1 12 20c-7 0-11-8-11-8a18.45 18.45 0 0 1 5.06-5.94"/><path d="M9.9 4.24A9.12 9.12 0 0 1 12 4c7 0 11 8 11 8a18.5 18.5 0 0 1-2.16 3.19"/><line x1="1" y1="1" x2="23" y2="23"/></svg>
                        </button>
                    </div>
                </div>
                <div class="form-group checkbox-group">
                    <label class="checkbox-label">
                        <input type="checkbox" id="register-age-confirmation" required>
                        <span>Confirmo que soy mayor de 18 años</span>
                    </label>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-register-accept">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="width:18px;height:18px;flex-shrink:0;"><polyline points="20 6 9 17 4 12"/></svg>
                        Crear Cuenta
                    </button>
                    <button type="button" class="btn btn-register-cancel" id="cancel-register">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" style="width:18px;height:18px;flex-shrink:0;"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                        Cancelar
                    </button>
                </div>
            </form>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- PANTALLA DE ONBOARDING                       -->
    <!-- ============================================ -->
    <div id="onboarding-screen" class="screen">
        <div class="onboarding-container">
            <button class="back-button" id="back-from-onboarding">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            </button>
            <div class="progress-bar"><div class="progress-fill" id="onboarding-progress"></div></div>
            <h2 class="screen-title">Completa tu Perfil</h2>
            <p class="screen-subtitle">Cuéntanos sobre ti</p>

            <form id="onboarding-form" class="auth-form">
                <div class="form-step active" data-step="1">
                    <div class="form-group">
                        <label for="profile-name">Nombre</label>
                        <input type="text" id="profile-name" required placeholder="Tu nombre">
                    </div>
                    <div class="form-group">
                        <label for="profile-birthdate">Fecha de nacimiento</label>
                        <input type="date" id="profile-birthdate" required>
                    </div>
                    <div class="form-group">
                        <label for="profile-gender">Género</label>
                        <select id="profile-gender" required>
                            <option value="">Selecciona</option>
                            <option value="Hombre">Hombre</option>
                            <option value="Mujer">Mujer</option>
                            <option value="Otro">Otro</option>
                        </select>
                    </div>
                </div>

                <div class="form-step" data-step="2">
                    <div class="form-group">
                        <label>¿Qué buscas?</label>
                        <div class="button-group">
                            <button type="button" class="choice-btn" data-value="Hombres">Hombres</button>
                            <button type="button" class="choice-btn" data-value="Mujeres">Mujeres</button>
                            <button type="button" class="choice-btn" data-value="Todos">Todos</button>
                        </div>
                        <input type="hidden" id="profile-seeking" required>
                    </div>
                    <div class="form-group">
                        <label>Ubicación</label>
                        <div class="location-input-locked">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="3" y="11" width="18" height="11" rx="2" ry="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg>
                            <input type="text" value="León, Guanajuato" disabled>
                        </div>
                        <p class="help-text">Tu ubicación está bloqueada en León, Gto para conectar con personas locales</p>
                    </div>
                </div>

                <div class="form-step" data-step="3">
                    <div class="form-group">
                        <label for="profile-bio">Biografía</label>
                        <textarea id="profile-bio" rows="4" placeholder="Cuéntanos sobre ti..." maxlength="300"></textarea>
                        <span class="char-count"><span id="bio-count">0</span>/300</span>
                    </div>
                    <div class="form-group">
                        <label for="profile-interests">Intereses</label>
                        <input type="text" id="profile-interests" placeholder="Ej: Fotografía, Deportes, Música">
                    </div>
                </div>

                <div class="form-navigation">
                    <button type="button" class="btn btn-secondary" id="prev-step" style="display:none;">Anterior</button>
                    <button type="button" class="btn btn-primary" id="next-step">Siguiente</button>
                    <button type="submit" class="btn btn-success" id="complete-profile" style="display:none;">Completar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- PANTALLA DE DESCUBRIMIENTO                   -->
    <!-- ============================================ -->
    <div id="discovery-screen" class="screen">
        <header class="app-header">
            <button class="menu-btn" id="open-menu">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
            </button>
            <span class="header-logo">LionMatch</span>
            <div class="header-location">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
            </div>
        </header>
        <div class="discovery-container">
            <div class="cards-stack" id="cards-stack">
                <div class="no-more-cards" id="no-more-cards" style="display:none;">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                    <h3>No hay más perfiles</h3>
                    <p>¡Vuelve más tarde!</p>
                </div>
            </div>
            <div class="action-buttons">
                <button class="action-btn dislike-btn" id="dislike-btn">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
                </button>
                <button class="action-btn like-btn" id="like-btn">
                    <svg viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                </button>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- PANTALLA DE MENSAJES                         -->
    <!-- ============================================ -->
    <div id="messages-screen" class="screen">
        <header class="app-header">
            <button class="menu-btn" id="messages-menu-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
            </button>
            <span class="header-title">Mensajes</span>
            <div style="width:40px;"></div>
        </header>
        <div class="messages-container">
            <div class="matches-carousel" id="matches-carousel"></div>
            <div class="conversations-list" id="conversations-list">
                <div class="empty-state" id="empty-messages">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                    <h3>Sin mensajes aún</h3>
                    <p>Tus conversaciones aparecerán aquí</p>
                </div>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- PANTALLA DE CHAT                             -->
    <!-- ============================================ -->
    <div id="chat-screen" class="screen">
        <div class="chat-header">
            <button class="back-button" id="back-from-chat" style="margin:0;">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            </button>
            <div class="chat-user-info">
                <img src="" alt="avatar" class="chat-avatar" id="chat-user-avatar">
                <div>
                    <h3 id="chat-user-name">Usuario</h3>
                    <span class="online-status">En línea</span>
                </div>
            </div>
        </div>
        <div class="chat-messages" id="chat-messages"></div>
        <div class="chat-input-container">
            <input type="text" id="chat-input" placeholder="Escribe un mensaje...">
            <button class="send-btn" id="send-message-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg>
            </button>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- PANTALLA DE PERFIL                           -->
    <!-- ============================================ -->
    <div id="profile-screen" class="screen">
        <header class="app-header">
            <button class="menu-btn" id="profile-menu-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="3" y1="12" x2="21" y2="12"/><line x1="3" y1="6" x2="21" y2="6"/><line x1="3" y1="18" x2="21" y2="18"/></svg>
            </button>
            <span class="header-title">Mi Perfil</span>
            <div style="width:40px;"></div>
        </header>
        <div class="profile-container">
            <div class="profile-card">
                <div class="profile-photo">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                </div>
                <h2 id="profile-display-name">Nombre</h2>
                <p class="profile-age" id="profile-display-age">Edad</p>
            </div>
            <div class="profile-info">
                <div class="info-section"><h3>Sobre mí</h3><p id="profile-display-bio">Sin biografía</p></div>
                <div class="info-section"><h3>Intereses</h3><p id="profile-display-interests">Sin intereses</p></div>
                <div class="info-section"><h3>Busco</h3><p id="profile-display-seeking">No especificado</p></div>
            </div>
            <div class="profile-actions">
                <button class="btn btn-primary" id="edit-profile-btn">Editar perfil</button>
                <button class="btn btn-danger" id="delete-account-btn">Eliminar cuenta</button>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- PANTALLA EDITAR PERFIL                       -->
    <!-- ============================================ -->
    <div id="edit-profile-screen" class="screen">
        <div class="edit-profile-container">
            <button class="back-button" id="back-from-edit">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 12H5M12 19l-7-7 7-7"/></svg>
            </button>
            <h2 class="screen-title">Editar Perfil</h2>
            <p class="screen-subtitle">Actualiza tu información</p>
            <form id="edit-profile-form" class="auth-form">
                <div class="form-group">
                    <label for="edit-name">Nombre</label>
                    <input type="text" id="edit-name" required placeholder="Tu nombre">
                </div>
                <div class="form-group">
                    <label for="edit-bio">Biografía</label>
                    <textarea id="edit-bio" rows="4" placeholder="Cuéntanos sobre ti..." maxlength="300"></textarea>
                    <span class="char-count"><span id="edit-bio-count">0</span>/300</span>
                </div>
                <div class="form-group">
                    <label for="edit-interests">Intereses</label>
                    <input type="text" id="edit-interests" placeholder="Ej: Fotografía, Deportes, Música">
                </div>
                <div class="form-group">
                    <label>¿Qué buscas?</label>
                    <div class="button-group">
                        <button type="button" class="choice-btn" data-value="Hombres">Hombres</button>
                        <button type="button" class="choice-btn" data-value="Mujeres">Mujeres</button>
                        <button type="button" class="choice-btn" data-value="Todos">Todos</button>
                    </div>
                    <input type="hidden" id="edit-seeking">
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-success">Guardar cambios</button>
                    <button type="button" class="btn btn-secondary" id="cancel-edit">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- SIDEBAR                                      -->
    <!-- ============================================ -->
    <div id="sidebar" class="sidebar">
        <div class="sidebar-header">
            <h2>LionMatch</h2>
            <p>León, Guanajuato</p>
            <button class="close-sidebar" id="close-sidebar">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
            </button>
        </div>
        <nav class="sidebar-nav">
            <a href="#" class="nav-item active" data-screen="discovery">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                Descubrir
            </a>
            <a href="#" class="nav-item" data-screen="messages">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
                Mensajes
            </a>
            <a href="#" class="nav-item" data-screen="profile">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"/><circle cx="12" cy="7" r="4"/></svg>
                Mi Perfil
            </a>
        </nav>
        <div class="sidebar-footer">
            <button class="logout-btn" id="logout-btn">
                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h4"/><polyline points="16 17 21 12 16 7"/><line x1="21" y1="12" x2="9" y2="12"/></svg>
                Cerrar Sesión
            </button>
        </div>
    </div>
    <div id="sidebar-overlay" class="sidebar-overlay"></div>

    <!-- TOAST -->
    <div id="toast" class="toast"></div>

    <!-- ============================================ -->
    <!-- MODAL ELIMINAR CUENTA                        -->
    <!-- ============================================ -->
    <div id="delete-modal" class="win10-modal-overlay">
        <div class="win10-modal">
            <div class="win10-titlebar titlebar-error">
                <svg class="win10-titlebar-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14H6L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4h6v2"/></svg>
                <span class="win10-titlebar-text">Eliminar cuenta</span>
                <button class="win10-close-btn" data-close-modal="delete-modal"><svg viewBox="0 0 10 10" fill="none" stroke="white" stroke-width="1.5"><line x1="1" y1="1" x2="9" y2="9"/><line x1="9" y1="1" x2="1" y2="9"/></svg></button>
            </div>
            <div class="win10-modal-body">
                <div class="win10-modal-icon-wrap icon-error">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                </div>
                <div class="win10-modal-content">
                    <p class="win10-modal-title">¿Eliminar tu cuenta?</p>
                    <p class="win10-modal-message">Esta acción es permanente y no se puede deshacer. Se eliminarán todos tus datos, matches y mensajes.</p>
                </div>
            </div>
            <div class="win10-modal-footer">
                <button class="win10-btn" data-close-modal="delete-modal" id="cancel-delete">Cancelar</button>
                <button class="win10-btn win10-btn-danger" id="confirm-delete">Eliminar</button>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- MODAL WIN10 - ERROR                          -->
    <!-- ============================================ -->
    <div id="win10-error-modal" class="win10-modal-overlay">
        <div class="win10-modal">
            <div class="win10-titlebar titlebar-error">
                <svg class="win10-titlebar-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="15" y1="9" x2="9" y2="15"/><line x1="9" y1="9" x2="15" y2="15"/></svg>
                <span class="win10-titlebar-text" id="win10-error-title">Error</span>
                <button class="win10-close-btn" data-close-modal="win10-error-modal"><svg viewBox="0 0 10 10" fill="none" stroke="white" stroke-width="1.5"><line x1="1" y1="1" x2="9" y2="9"/><line x1="9" y1="1" x2="1" y2="9"/></svg></button>
            </div>
            <div class="win10-modal-body">
                <div class="win10-modal-icon-wrap icon-error">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                </div>
                <div class="win10-modal-content">
                    <p class="win10-modal-title" id="win10-error-title-inner">Ha ocurrido un error</p>
                    <p class="win10-modal-message" id="win10-error-message">Mensaje de error aquí.</p>
                </div>
            </div>
            <div class="win10-modal-footer">
                <button class="win10-btn win10-btn-danger" data-close-modal="win10-error-modal">Aceptar</button>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- MODAL WIN10 - ÉXITO                          -->
    <!-- ============================================ -->
    <div id="win10-success-modal" class="win10-modal-overlay">
        <div class="win10-modal">
            <div class="win10-titlebar titlebar-success">
                <svg class="win10-titlebar-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                <span class="win10-titlebar-text" id="win10-success-title">Operación exitosa</span>
                <button class="win10-close-btn" data-close-modal="win10-success-modal"><svg viewBox="0 0 10 10" fill="none" stroke="white" stroke-width="1.5"><line x1="1" y1="1" x2="9" y2="9"/><line x1="9" y1="1" x2="1" y2="9"/></svg></button>
            </div>
            <div class="win10-modal-body">
                <div class="win10-modal-icon-wrap icon-success">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
                </div>
                <div class="win10-modal-content">
                    <p class="win10-modal-title" id="win10-success-title-inner">¡Éxito!</p>
                    <p class="win10-modal-message" id="win10-success-message">La operación fue exitosa.</p>
                </div>
            </div>
            <div class="win10-modal-footer">
                <button class="win10-btn win10-btn-primary" id="win10-success-ok-btn" data-close-modal="win10-success-modal">Aceptar</button>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- MODAL WIN10 - RECUPERAR CONTRASEÑA           -->
    <!-- ============================================ -->
    <div id="win10-recovery-modal" class="win10-modal-overlay">
        <div class="win10-modal">
            <div class="win10-titlebar titlebar-info">
                <svg class="win10-titlebar-icon" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2"><path d="M4 4h16c1.1 0 2 .9 2 2v12c0 1.1-.9 2-2 2H4c-1.1 0-2-.9-2-2V6c0-1.1.9-2 2-2z"/><polyline points="22,6 12,13 2,6"/></svg>
                <span class="win10-titlebar-text">Recuperar contraseña</span>
                <button class="win10-close-btn" data-close-modal="win10-recovery-modal"><svg viewBox="0 0 10 10" fill="none" stroke="white" stroke-width="1.5"><line x1="1" y1="1" x2="9" y2="9"/><line x1="9" y1="1" x2="1" y2="9"/></svg></button>
            </div>
            <div class="win10-modal-body">
                <div class="win10-modal-icon-wrap icon-info">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>
                </div>
                <div class="win10-modal-content">
                    <p class="win10-modal-title">Restablecer contraseña</p>
                    <p class="win10-modal-message">Ingresa tu correo y te enviaremos un enlace para restablecer tu contraseña.</p>
                </div>
            </div>
            <div class="win10-modal-input-wrap">
                <input type="email" class="win10-modal-input" id="win10-recovery-email" placeholder="tucorreo@ejemplo.com">
            </div>
            <div class="win10-modal-footer">
                <button class="win10-btn" data-close-modal="win10-recovery-modal">Cancelar</button>
                <button class="win10-btn win10-btn-primary" id="send-recovery-btn">Enviar</button>
            </div>
        </div>
    </div>

    <!-- ============================================ -->
    <!-- MODAL MATCH                                  -->
    <!-- ============================================ -->
    <div id="match-modal" class="win10-modal-overlay">
        <div class="win10-modal">
            <div class="win10-titlebar titlebar-match">
                <svg class="win10-titlebar-icon" viewBox="0 0 24 24" fill="white" stroke="white" stroke-width="2"><path d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"/></svg>
                <span class="win10-titlebar-text">¡Es un Match!</span>
                <button class="win10-close-btn" id="close-match-modal" data-close-modal="match-modal"><svg viewBox="0 0 10 10" fill="none" stroke="white" stroke-width="1.5"><line x1="1" y1="1" x2="9" y2="9"/><line x1="9" y1="1" x2="1" y2="9"/></svg></button>
            </div>
            <div class="win10-modal-body" style="flex-direction:column;align-items:center;text-align:center;gap:12px;">
                <img id="match-user-photo" src="" alt="Match" style="width:90px;height:90px;border-radius:50%;object-fit:cover;border:3px solid var(--primary);margin-top:8px;">
                <div class="win10-modal-content" style="text-align:center;">
                    <p class="win10-modal-title" style="font-size:18px;">¡Han hecho Match! 🎉</p>
                    <p class="win10-modal-message">Los dos se gustaron. ¡Empieza la conversación ahora!</p>
                </div>
            </div>
            <div class="win10-modal-footer">
                <button class="win10-btn" data-close-modal="match-modal" id="close-match-modal-btn">Después</button>
                <button class="win10-btn win10-btn-primary" id="send-match-message">Enviar mensaje</button>
            </div>
        </div>
    </div>

</div><!-- /#app -->

<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
<script>
// ================================================
// LIONMATCH - APLICACIÓN PRINCIPAL
// ================================================

const SUPABASE_URL      = 'https://fjevgfyqqsfankvledpl.supabase.co';
const SUPABASE_ANON_KEY = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImZqZXZnZnlxcXNmYW5rdmxlZHBsIiwicm9sZSI6ImFub24iLCJpYXQiOjE3NzA2Nzk0NjIsImV4cCI6MjA4NjI1NTQ2Mn0.AmysLsRq_KBXYculm0Nyw3a0abWLQ8zTt-2OSo-6PSA';

const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);

let currentUser         = null;
let currentScreen       = 'login';
let onboardingStep      = 1;
let profiles            = [];
let currentProfileIndex = 0;
let matches             = [];
let conversations       = [];

document.addEventListener('DOMContentLoaded', () => { initializeApp(); });

async function initializeApp() {
    const { data: { session } } = await supabase.auth.getSession();
    if (session) {
        currentUser = session.user;
        await loadUserProfile();
        const { data: profile } = await supabase.from('profiles').select('*').eq('user_id', currentUser.id).single();
        if (profile && profile.name) { showScreen('discovery'); await loadProfiles(); }
        else { showScreen('onboarding'); }
    } else {
        showScreen('login');
    }
    initializeEventListeners();
}

// ================================================
// EVENT LISTENERS
// ================================================
function initializeEventListeners() {
    document.getElementById('login-form')?.addEventListener('submit', handleLogin);
    document.getElementById('go-to-register')?.addEventListener('click', () => showScreen('register'));
    document.getElementById('forgot-password-link')?.addEventListener('click', handleForgotPassword);

    document.getElementById('register-form')?.addEventListener('submit', handleRegister);
    document.getElementById('back-to-login')?.addEventListener('click', () => showScreen('login'));
    document.getElementById('cancel-register')?.addEventListener('click', () => showScreen('login'));

    document.querySelectorAll('.toggle-password').forEach(btn => {
        btn.addEventListener('click', function () {
            const targetId  = this.getAttribute('data-target');
            const input     = document.getElementById(targetId);
            const eyeOpen   = this.querySelector('.eye-open');
            const eyeClosed = this.querySelector('.eye-closed');
            if (input.type === 'password') {
                input.type = 'text';
                if (eyeOpen)   eyeOpen.style.display   = 'none';
                if (eyeClosed) eyeClosed.style.display = 'block';
                this.setAttribute('aria-label', 'Ocultar contraseña');
            } else {
                input.type = 'password';
                if (eyeOpen)   eyeOpen.style.display   = 'block';
                if (eyeClosed) eyeClosed.style.display = 'none';
                this.setAttribute('aria-label', 'Mostrar contraseña');
            }
        });
    });

    document.getElementById('onboarding-form')?.addEventListener('submit', handleCompleteProfile);
    document.getElementById('next-step')?.addEventListener('click', nextOnboardingStep);
    document.getElementById('prev-step')?.addEventListener('click', prevOnboardingStep);
    document.getElementById('back-from-onboarding')?.addEventListener('click', handleLogout);

    document.querySelectorAll('.choice-btn').forEach(btn => {
        btn.addEventListener('click', function () {
            const group       = this.parentElement;
            const hiddenInput = group.nextElementSibling;
            group.querySelectorAll('.choice-btn').forEach(b => b.classList.remove('active'));
            this.classList.add('active');
            if (hiddenInput && hiddenInput.tagName === 'INPUT') hiddenInput.value = this.getAttribute('data-value');
        });
    });

    const bioInput = document.getElementById('profile-bio');
    const bioCount = document.getElementById('bio-count');
    bioInput?.addEventListener('input', () => { bioCount.textContent = bioInput.value.length; });

    const editBioInput = document.getElementById('edit-bio');
    const editBioCount = document.getElementById('edit-bio-count');
    editBioInput?.addEventListener('input', () => { editBioCount.textContent = editBioInput.value.length; });

    document.getElementById('like-btn')?.addEventListener('click', () => handleSwipe('like'));
    document.getElementById('dislike-btn')?.addEventListener('click', () => handleSwipe('dislike'));

    document.querySelectorAll('#open-menu, #messages-menu-btn, #profile-menu-btn').forEach(btn => {
        btn.addEventListener('click', openSidebar);
    });
    document.getElementById('close-sidebar')?.addEventListener('click', closeSidebar);
    document.getElementById('sidebar-overlay')?.addEventListener('click', closeSidebar);

    document.querySelectorAll('.nav-item').forEach(item => {
        item.addEventListener('click', (e) => {
            e.preventDefault();
            const screen = item.getAttribute('data-screen');
            showScreen(screen);
            closeSidebar();
            if (screen === 'discovery') loadProfiles();
            else if (screen === 'messages') { loadMatches(); loadConversations(); }
            else if (screen === 'profile') displayUserProfile();
        });
    });

    document.getElementById('edit-profile-btn')?.addEventListener('click', () => {
        populateEditForm(); showScreen('edit-profile');
    });
    document.getElementById('delete-account-btn')?.addEventListener('click', () => {
        document.getElementById('delete-modal').classList.add('active');
    });
    document.getElementById('confirm-delete')?.addEventListener('click', handleDeleteAccount);
    document.getElementById('cancel-delete')?.addEventListener('click', () => {
        document.getElementById('delete-modal').classList.remove('active');
    });

    document.getElementById('edit-profile-form')?.addEventListener('submit', handleUpdateProfile);
    document.getElementById('back-from-edit')?.addEventListener('click', () => showScreen('profile'));
    document.getElementById('cancel-edit')?.addEventListener('click', () => showScreen('profile'));

    document.getElementById('back-from-chat')?.addEventListener('click', () => showScreen('messages'));
    document.getElementById('send-message-btn')?.addEventListener('click', handleSendMessage);
    document.getElementById('chat-input')?.addEventListener('keypress', (e) => {
        if (e.key === 'Enter') handleSendMessage();
    });

    document.getElementById('logout-btn')?.addEventListener('click', handleLogout);

    document.querySelectorAll('.win10-modal-overlay').forEach(overlay => {
        overlay.addEventListener('click', (e) => {
            if (e.target === overlay) overlay.classList.remove('active');
        });
    });
    document.querySelectorAll('[data-close-modal]').forEach(btn => {
        btn.addEventListener('click', () => {
            const modalId = btn.getAttribute('data-close-modal');
            hideWin10Modal(modalId);
        });
    });

    document.getElementById('send-recovery-btn')?.addEventListener('click', handlePasswordRecovery);

    document.getElementById('close-match-modal')?.addEventListener('click', () => {
        document.getElementById('match-modal')?.classList.remove('active');
    });
    document.getElementById('send-match-message')?.addEventListener('click', () => {
        document.getElementById('match-modal')?.classList.remove('active');
        showScreen('chat');
    });
}

// ================================================
// MODALES WIN10
// ================================================
function showWin10Modal(modalId) {
    const el = document.getElementById(modalId);
    if (el) el.classList.add('active');
}
function hideWin10Modal(modalId) {
    const el = document.getElementById(modalId);
    if (el) el.classList.remove('active');
}
function showErrorWin10(message, title = 'Error') {
    const titleEl = document.getElementById('win10-error-title');
    const msgEl   = document.getElementById('win10-error-message');
    if (titleEl) titleEl.textContent = title;
    if (msgEl)   msgEl.textContent   = message;
    showWin10Modal('win10-error-modal');
}
function showSuccessWin10(message, title = 'Operación exitosa') {
    const titleEl = document.getElementById('win10-success-title');
    const msgEl   = document.getElementById('win10-success-message');
    if (titleEl) titleEl.textContent = title;
    if (msgEl)   msgEl.textContent   = message;
    showWin10Modal('win10-success-modal');
}

// ================================================
// AUTENTICACIÓN
// ================================================
async function handleLogin(e) {
    e.preventDefault();
    const email           = document.getElementById('login-email').value;
    const password        = document.getElementById('login-password').value;
    const ageConfirmation = document.getElementById('age-confirmation').checked;
    if (!ageConfirmation) { showToast('Debes confirmar que eres mayor de edad', 'error'); return; }
    try {
        const { data, error } = await supabase.auth.signInWithPassword({ email, password });
        if (error) throw error;
        currentUser = data.user;
        await loadUserProfile();
        showToast('¡Bienvenido de nuevo!', 'success');
        showScreen('discovery');
        await loadProfiles();
    } catch (error) {
        console.error('Error en login:', error);
        showToast('Email o contraseña incorrectos', 'error');
    }
}

async function handleRegister(e) {
    e.preventDefault();
    const email           = document.getElementById('register-email').value.trim();
    const password        = document.getElementById('register-password').value;
    const passwordConfirm = document.getElementById('register-password-confirm').value;
    const ageConfirm      = document.getElementById('register-age-confirmation').checked;

    if (!ageConfirm)  { showErrorWin10('Debes confirmar que eres mayor de 18 años para registrarte.', 'Verificación de edad'); return; }
    if (!email || !email.includes('@')) { showErrorWin10('Ingresa un correo electrónico válido.', 'Correo inválido'); return; }
    if (password.length < 6) { showErrorWin10('La contraseña debe tener al menos 6 caracteres.', 'Contraseña muy corta'); return; }
    if (password !== passwordConfirm) { showErrorWin10('Las contraseñas no coinciden. Verifica e intenta de nuevo.', 'Contraseñas distintas'); return; }

    const registerBtn = document.querySelector('#register-form .btn-register-accept');
    if (registerBtn) { registerBtn.classList.add('loading'); registerBtn.disabled = true; }

    try {
        const { data: existingProfile, error: checkError } = await supabase
            .from('profiles').select('user_id').eq('email', email).maybeSingle();
        if (checkError) console.warn('Error al verificar correo:', checkError);
        if (existingProfile) {
            showErrorWin10(`El correo "${email}" ya está registrado en LionMatch.\nIntenta iniciar sesión o usa otro correo.`, 'Cuenta ya existente');
            return;
        }

        const { data, error } = await supabase.auth.signUp({
            email, password,
            options: { data: { email }, emailRedirectTo: 'https://flavioalejandrov24-lang.github.io/Citasyparejasleongto/' }
        });

        if (error) {
            const msg = error.message?.toLowerCase() || '';
            if (msg.includes('already registered') || msg.includes('user already exists') || msg.includes('already been registered')) {
                showErrorWin10(`El correo "${email}" ya tiene una cuenta en LionMatch.\nPor favor inicia sesión o recupera tu contraseña.`, 'Cuenta ya existente');
            } else {
                showErrorWin10(error.message || 'Ocurrió un error al crear la cuenta. Intenta nuevamente.', 'Error de registro');
            }
            return;
        }

        if (data?.user && data.user.identities && data.user.identities.length === 0) {
            showErrorWin10(`El correo "${email}" ya está registrado.\nRevisa tu bandeja de entrada o recupera tu contraseña.`, 'Cuenta ya existente');
            return;
        }

        currentUser = data.user;
        const { error: profileError } = await supabase.from('profiles').insert({
            user_id: currentUser.id, email: email, created_at: new Date().toISOString()
        });
        if (profileError) console.error('Error al crear perfil inicial:', profileError);

        showSuccessWin10(
            `¡Hola! Tu cuenta fue creada con éxito.\nRevisa tu correo "${email}" para confirmar tu cuenta y activar tu perfil en LionMatch.`,
            'Registro exitoso'
        );

        const okBtn = document.getElementById('win10-success-ok-btn');
        if (okBtn) {
            const goOnboarding = () => {
                hideWin10Modal('win10-success-modal');
                showScreen('onboarding');
                okBtn.removeEventListener('click', goOnboarding);
            };
            okBtn.addEventListener('click', goOnboarding);
        }
    } catch (error) {
        console.error('Error en registro:', error);
        showErrorWin10('Error inesperado al crear la cuenta. Por favor intenta nuevamente.', 'Error de registro');
    } finally {
        if (registerBtn) { registerBtn.classList.remove('loading'); registerBtn.disabled = false; }
    }
}

async function handleForgotPassword(e) {
    e.preventDefault();
    const inputEl = document.getElementById('win10-recovery-email');
    if (inputEl) inputEl.value = '';
    showWin10Modal('win10-recovery-modal');
}

async function handlePasswordRecovery() {
    const inputEl = document.getElementById('win10-recovery-email');
    const email   = inputEl ? inputEl.value.trim() : '';
    if (!email || !email.includes('@')) { showErrorWin10('Ingresa un correo electrónico válido.', 'Correo inválido'); return; }

    const sendBtn = document.getElementById('send-recovery-btn');
    if (sendBtn) { sendBtn.disabled = true; sendBtn.textContent = 'Enviando...'; }
    try {
        const { error } = await supabase.auth.resetPasswordForEmail(email, {
            redirectTo: 'https://flavioalejandrov24-lang.github.io/Citasyparejasleongto/'
        });
        if (error) throw error;
        hideWin10Modal('win10-recovery-modal');
        showSuccessWin10(`Te enviamos un enlace a "${email}" para restablecer tu contraseña.\nRevisa también tu carpeta de spam.`, 'Correo enviado');
    } catch (error) {
        console.error('Error recuperación:', error);
        showErrorWin10('No se pudo enviar el correo. Verifica el email e intenta nuevamente.', 'Error al enviar');
    } finally {
        if (sendBtn) { sendBtn.disabled = false; sendBtn.textContent = 'Enviar'; }
    }
}

async function handleLogout() {
    try {
        const { error } = await supabase.auth.signOut();
        if (error) throw error;
        currentUser = null;
        showScreen('login');
        showToast('Sesión cerrada', 'success');
    } catch (error) {
        console.error('Error al cerrar sesión:', error);
        showToast('Error al cerrar sesión', 'error');
    }
}

// ================================================
// ONBOARDING
// ================================================
function nextOnboardingStep() {
    const currentStepElement = document.querySelector(`.form-step[data-step="${onboardingStep}"]`);
    const inputs = currentStepElement.querySelectorAll('input[required], select[required]');
    let isValid = true;
    inputs.forEach(input => {
        if (!input.value) {
            isValid = false;
            input.style.borderColor = 'var(--danger)';
            setTimeout(() => { input.style.borderColor = ''; }, 2000);
        }
    });
    if (!isValid) { showToast('Completa todos los campos requeridos', 'error'); return; }
    if (onboardingStep < 3) { onboardingStep++; updateOnboardingUI(); }
}
function prevOnboardingStep() {
    if (onboardingStep > 1) { onboardingStep--; updateOnboardingUI(); }
}
function updateOnboardingUI() {
    document.querySelectorAll('.form-step').forEach(step => step.classList.remove('active'));
    document.querySelector(`.form-step[data-step="${onboardingStep}"]`).classList.add('active');
    document.getElementById('onboarding-progress').style.width = `${(onboardingStep / 3) * 100}%`;
    document.getElementById('prev-step').style.display         = onboardingStep > 1 ? 'block' : 'none';
    document.getElementById('next-step').style.display         = onboardingStep < 3 ? 'block' : 'none';
    document.getElementById('complete-profile').style.display  = onboardingStep === 3 ? 'block' : 'none';
}

async function handleCompleteProfile(e) {
    e.preventDefault();
    const name      = document.getElementById('profile-name').value;
    const birthdate = document.getElementById('profile-birthdate').value;
    const gender    = document.getElementById('profile-gender').value;
    const seeking   = document.getElementById('profile-seeking').value;
    const bio       = document.getElementById('profile-bio').value || '';
    const interests = document.getElementById('profile-interests').value || '';
    const age       = calculateAge(birthdate);
    if (age < 18) { showToast('Debes ser mayor de 18 años', 'error'); return; }
    if (!seeking)  { showToast('Selecciona qué buscas', 'error'); return; }
    try {
        const { error } = await supabase.from('profiles').update({
            name, birthdate, age, gender, seeking, bio, interests,
            location: 'León, Guanajuato', updated_at: new Date().toISOString()
        }).eq('user_id', currentUser.id);
        if (error) throw error;
        await loadUserProfile();
        showToast('¡Perfil completado!', 'success');
        showScreen('discovery');
        await loadProfiles();
    } catch (error) {
        console.error('Error al completar perfil:', error);
        showToast('Error al guardar el perfil', 'error');
    }
}

// ================================================
// PERFIL
// ================================================
async function loadUserProfile() {
    try {
        const { data, error } = await supabase.from('profiles').select('*').eq('user_id', currentUser.id).single();
        if (error) throw error;
        currentUser.profile = data;
    } catch (error) { console.error('Error al cargar perfil:', error); }
}
function displayUserProfile() {
    const profile = currentUser.profile;
    document.getElementById('profile-display-name').textContent      = profile.name;
    document.getElementById('profile-display-age').textContent       = `${profile.age} años`;
    document.getElementById('profile-display-bio').textContent       = profile.bio || 'Sin biografía';
    document.getElementById('profile-display-interests').textContent = profile.interests || 'Sin intereses';
    document.getElementById('profile-display-seeking').textContent   = profile.seeking || 'No especificado';
}
function populateEditForm() {
    const profile = currentUser.profile;
    document.getElementById('edit-name').value      = profile.name || '';
    document.getElementById('edit-bio').value       = profile.bio || '';
    document.getElementById('edit-interests').value = profile.interests || '';
    document.getElementById('edit-seeking').value   = profile.seeking || '';
    document.getElementById('edit-bio-count').textContent = (profile.bio || '').length;
    document.querySelectorAll('#edit-profile-screen .choice-btn').forEach(btn => {
        btn.classList.toggle('active', btn.getAttribute('data-value') === profile.seeking);
    });
}
async function handleUpdateProfile(e) {
    e.preventDefault();
    const name      = document.getElementById('edit-name').value;
    const bio       = document.getElementById('edit-bio').value;
    const interests = document.getElementById('edit-interests').value;
    const seeking   = document.getElementById('edit-seeking').value;
    if (!seeking) { showToast('Selecciona qué buscas', 'error'); return; }
    try {
        const { error } = await supabase.from('profiles').update({
            name, bio, interests, seeking, updated_at: new Date().toISOString()
        }).eq('user_id', currentUser.id);
        if (error) throw error;
        await loadUserProfile();
        showToast('Perfil actualizado', 'success');
        showScreen('profile');
        displayUserProfile();
    } catch (error) {
        console.error('Error al actualizar perfil:', error);
        showToast('Error al actualizar el perfil', 'error');
    }
}
async function handleDeleteAccount() {
    try {
        await supabase.from('profiles').delete().eq('user_id', currentUser.id);
        await supabase.from('likes').delete().or(`user_id.eq.${currentUser.id},liked_user_id.eq.${currentUser.id}`);
        await supabase.from('matches').delete().or(`user1_id.eq.${currentUser.id},user2_id.eq.${currentUser.id}`);
        await supabase.from('messages').delete().or(`sender_id.eq.${currentUser.id},receiver_id.eq.${currentUser.id}`);
        const { error } = await supabase.auth.admin.deleteUser(currentUser.id);
        if (error) throw error;
        showToast('Cuenta eliminada', 'success');
        currentUser = null;
        document.getElementById('delete-modal').classList.remove('active');
        showScreen('login');
    } catch (error) {
        console.error('Error al eliminar cuenta:', error);
        showToast('Error al eliminar la cuenta. Contacta a soporte.', 'error');
    }
}

// ================================================
// DESCUBRIMIENTO
// ================================================
async function loadProfiles() {
    try {
        const myProfile = currentUser.profile;
        const { data: likedUsers } = await supabase.from('likes').select('liked_user_id').eq('user_id', currentUser.id);
        const likedIds = likedUsers ? likedUsers.map(l => l.liked_user_id) : [];
        likedIds.push(currentUser.id);

        let query = supabase.from('profiles').select('*')
            .eq('location', 'León, Guanajuato')
            .not('user_id', 'in', `(${likedIds.join(',')})`);
        if (myProfile.seeking !== 'Todos') {
            query = query.eq('gender', myProfile.seeking === 'Hombres' ? 'Hombre' : 'Mujer');
        }
        const { data, error } = await query.limit(20);
        if (error) throw error;
        profiles = data || [];
        currentProfileIndex = 0;
        renderCurrentProfile();
    } catch (error) {
        console.error('Error al cargar perfiles:', error);
        showToast('Error al cargar perfiles', 'error');
    }
}

function renderCurrentProfile() {
    const cardsStack = document.getElementById('cards-stack');
    cardsStack.innerHTML = '';
    if (currentProfileIndex >= profiles.length) {
        document.getElementById('no-more-cards').style.display = 'flex';
        return;
    }
    const profile = profiles[currentProfileIndex];
    const card = document.createElement('div');
    card.className = 'profile-card-swipe';
    card.innerHTML = `
        <img src="https://i.pravatar.cc/400?u=${profile.user_id}" alt="${profile.name}">
        <div class="profile-card-info">
            <h3>${profile.name}, ${profile.age}</h3>
            <p>${profile.bio || 'Sin biografía'}</p>
        </div>
        <div class="swipe-indicator like">LIKE</div>
        <div class="swipe-indicator nope">NOPE</div>`;
    cardsStack.appendChild(card);

    let startX = 0, currentX = 0, isDragging = false;
    card.addEventListener('mousedown', startDrag);
    card.addEventListener('touchstart', startDrag);
    card.addEventListener('mousemove', drag);
    card.addEventListener('touchmove', drag);
    card.addEventListener('mouseup', endDrag);
    card.addEventListener('touchend', endDrag);
    card.addEventListener('mouseleave', endDrag);

    function startDrag(e) {
        isDragging = true;
        startX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
        card.style.transition = 'none';
    }
    function drag(e) {
        if (!isDragging) return;
        currentX = e.type.includes('mouse') ? e.clientX : e.touches[0].clientX;
        const diff = currentX - startX;
        card.style.transform = `translateX(${diff}px) rotate(${diff * 0.1}deg)`;
        card.querySelector('.swipe-indicator.like').classList.toggle('show', diff > 50);
        card.querySelector('.swipe-indicator.nope').classList.toggle('show', diff < -50);
    }
    function endDrag() {
        if (!isDragging) return;
        isDragging = false;
        const diff = currentX - startX;
        card.style.transition = 'transform .3s ease';
        if (diff > 100)       handleSwipe('like', card);
        else if (diff < -100) handleSwipe('dislike', card);
        else {
            card.style.transform = '';
            card.querySelector('.swipe-indicator.like').classList.remove('show');
            card.querySelector('.swipe-indicator.nope').classList.remove('show');
        }
    }
}

async function handleSwipe(action, cardElement = null) {
    const profile = profiles[currentProfileIndex];
    if (!cardElement) cardElement = document.querySelector('.profile-card-swipe');
    cardElement.style.transform = action === 'like'
        ? 'translateX(150%) rotate(30deg)'
        : 'translateX(-150%) rotate(-30deg)';
    setTimeout(() => { currentProfileIndex++; renderCurrentProfile(); }, 300);
    try {
        await supabase.from('likes').insert({
            user_id: currentUser.id, liked_user_id: profile.user_id,
            is_like: action === 'like', created_at: new Date().toISOString()
        });
        if (action === 'like') {
            const { data: reciprocalLike } = await supabase.from('likes').select('*')
                .eq('user_id', profile.user_id).eq('liked_user_id', currentUser.id)
                .eq('is_like', true).single();
            if (reciprocalLike) { await createMatch(profile); showMatchModal(profile); }
        }
    } catch (error) { console.error('Error al guardar like:', error); }
}

async function createMatch(profile) {
    try {
        await supabase.from('matches').insert({
            user1_id: currentUser.id, user2_id: profile.user_id, created_at: new Date().toISOString()
        });
        showToast('¡Es un Match!', 'success');
    } catch (error) { console.error('Error al crear match:', error); }
}

function showMatchModal(profile) {
    const modal = document.getElementById('match-modal');
    const photo = document.getElementById('match-user-photo');
    if (photo) photo.src = `https://i.pravatar.cc/150?u=${profile.user_id}`;
    if (modal) modal.classList.add('active');
}

// ================================================
// MENSAJES
// ================================================
async function loadMatches() {
    try {
        const { data, error } = await supabase.from('matches').select(`
            *, user1:profiles!matches_user1_id_fkey(*), user2:profiles!matches_user2_id_fkey(*)
        `).or(`user1_id.eq.${currentUser.id},user2_id.eq.${currentUser.id}`)
          .order('created_at', { ascending: false });
        if (error) throw error;
        matches = data || [];
        renderMatches();
    } catch (error) { console.error('Error al cargar matches:', error); }
}

function renderMatches() {
    const carousel = document.getElementById('matches-carousel');
    carousel.innerHTML = '';
    matches.forEach(match => {
        const otherUser = match.user1_id === currentUser.id ? match.user2 : match.user1;
        const div = document.createElement('div');
        div.className = 'match-item';
        div.innerHTML = `
            <img src="https://i.pravatar.cc/100?u=${otherUser.user_id}" alt="${otherUser.name}" class="match-avatar">
            <div class="match-name">${otherUser.name}</div>`;
        div.addEventListener('click', () => openChat(otherUser));
        carousel.appendChild(div);
    });
}

async function loadConversations() {
    try {
        const { data, error } = await supabase.from('messages').select(`
            *, sender:profiles!messages_sender_id_fkey(*), receiver:profiles!messages_receiver_id_fkey(*)
        `).or(`sender_id.eq.${currentUser.id},receiver_id.eq.${currentUser.id}`)
          .order('created_at', { ascending: false }).limit(50);
        if (error) throw error;
        const map = new Map();
        data?.forEach(msg => {
            const otherId = msg.sender_id === currentUser.id ? msg.receiver_id : msg.sender_id;
            if (!map.has(otherId)) {
                map.set(otherId, {
                    user: msg.sender_id === currentUser.id ? msg.receiver : msg.sender,
                    lastMessage: msg.content,
                    time: formatTime(msg.created_at),
                    online: Math.random() > 0.5
                });
            }
        });
        conversations = Array.from(map.values());
        renderConversations();
    } catch (error) { console.error('Error al cargar conversaciones:', error); }
}

function renderConversations() {
    const list = document.getElementById('conversations-list');
    if (conversations.length === 0) {
        list.innerHTML = `<div class="empty-state"><svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg><h3>Sin mensajes aún</h3><p>Tus conversaciones aparecerán aquí</p></div>`;
        return;
    }
    list.innerHTML = '';
    conversations.forEach(conv => {
        const div = document.createElement('div');
        div.className = 'conversation-item';
        div.innerHTML = `
            <div class="conversation-avatar-wrapper">
                <img src="https://i.pravatar.cc/100?u=${conv.user.user_id}" alt="${conv.user.name}" class="conversation-avatar">
                ${conv.online ? '<div class="online-indicator"></div>' : ''}
            </div>
            <div class="conversation-info">
                <div class="conversation-header">
                    <span class="conversation-name">${conv.user.name}</span>
                    <span class="conversation-time">${conv.time}</span>
                </div>
                <p class="conversation-message">${conv.lastMessage}</p>
            </div>`;
        div.addEventListener('click', () => openChat(conv.user));
        list.appendChild(div);
    });
}

function openChat(user) {
    showScreen('chat');
    document.getElementById('chat-user-avatar').src    = `https://i.pravatar.cc/100?u=${user.user_id}`;
    document.getElementById('chat-user-name').textContent = user.name;
    loadChatMessages(user.user_id);
}

async function loadChatMessages(otherUserId) {
    try {
        const { data, error } = await supabase.from('messages').select('*')
            .or(`and(sender_id.eq.${currentUser.id},receiver_id.eq.${otherUserId}),and(sender_id.eq.${otherUserId},receiver_id.eq.${currentUser.id})`)
            .order('created_at', { ascending: true });
        if (error) throw error;
        renderChatMessages(data || []);
    } catch (error) { console.error('Error al cargar mensajes:', error); }
}

function renderChatMessages(messages) {
    const container = document.getElementById('chat-messages');
    container.innerHTML = '';
    messages.forEach(msg => {
        const div = document.createElement('div');
        div.className = `message ${msg.sender_id === currentUser.id ? 'sent' : 'received'}`;
        div.innerHTML = `<div class="message-bubble">${msg.content}</div>`;
        container.appendChild(div);
    });
    container.scrollTop = container.scrollHeight;
}

async function handleSendMessage() {
    const input        = document.getElementById('chat-input');
    const content      = input.value.trim();
    if (!content) return;
    const chatUserName = document.getElementById('chat-user-name').textContent;
    const otherUser    = conversations.find(c => c.user.name === chatUserName)?.user;
    if (!otherUser) return;
    try {
        const { error } = await supabase.from('messages').insert({
            sender_id: currentUser.id, receiver_id: otherUser.user_id,
            content, created_at: new Date().toISOString()
        });
        if (error) throw error;
        input.value = '';
        loadChatMessages(otherUser.user_id);
    } catch (error) {
        console.error('Error al enviar mensaje:', error);
        showToast('Error al enviar mensaje', 'error');
    }
}

// ================================================
// UTILIDADES
// ================================================
function showScreen(screenId) {
    document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
    document.getElementById(`${screenId}-screen`).classList.add('active');
    currentScreen = screenId;
}
function showToast(message, type = 'success') {
    const toast = document.getElementById('toast');
    toast.textContent = message;
    toast.className = `toast ${type}`;
    toast.classList.add('show');
    setTimeout(() => toast.classList.remove('show'), 3000);
}
function openSidebar()  {
    document.getElementById('sidebar').classList.add('open');
    document.getElementById('sidebar-overlay').classList.add('active');
}
function closeSidebar() {
    document.getElementById('sidebar').classList.remove('open');
    document.getElementById('sidebar-overlay').classList.remove('active');
}
function calculateAge(birthdate) {
    const today = new Date();
    const birth = new Date(birthdate);
    let age = today.getFullYear() - birth.getFullYear();
    const m = today.getMonth() - birth.getMonth();
    if (m < 0 || (m === 0 && today.getDate() < birth.getDate())) age--;
    return age;
}
function formatTime(timestamp) {
    const date  = new Date(timestamp);
    const now   = new Date();
    const diffMs    = now - date;
    const diffMins  = Math.floor(diffMs / 60000);
    const diffHours = Math.floor(diffMs / 3600000);
    const diffDays  = Math.floor(diffMs / 86400000);
    if (diffMins < 1)   return 'Ahora';
    if (diffMins < 60)  return `${diffMins}m`;
    if (diffHours < 24) return `${diffHours}h`;
    if (diffDays < 7)   return `${diffDays}d`;
    return date.toLocaleDateString('es-MX', { day: 'numeric', month: 'short' });
}
</script>
</body>
</html>
